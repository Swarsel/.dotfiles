<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-06-20 Do 01:55 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emacs  Configuration</title>
<meta name="author" content="Leon Schwarzäugl" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Emacs  Configuration</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:a86fe971-f169-4052-aacf-15e0f267c6cd">1. Introduction (no code)</a></li>
<li><a href="#h:2c331451-45ed-4592-9e00-d36b5bf31248">2. Initialization (early-init.el)</a>
<ul>
<li><a href="#h:38e03b65-9dfc-4547-b27d-236664d7dc15">2.1. Increase startup performance</a></li>
<li><a href="#h:782b3632-afb2-4c67-8c46-ff94408aef5d">2.2. Setup frames</a></li>
<li><a href="#h:396c47f2-7e2f-4fad-ae71-6483bf7e3e42">2.3. Make C-i, C-m, C-[ available in graphic sessions</a></li>
</ul>
</li>
<li><a href="#h:601ba407-b906-4869-8ef6-67a9fc285fba">3. Personal settings</a>
<ul>
<li><a href="#h:b7b5976a-db2b-493d-8794-1924a0e12aec">3.1. Custom functions</a>
<ul>
<li><a href="#h:b715d7cf-da09-4e0c-95bc-8281b4f3ce9c">3.1.1. Emacs/Evil state toggle</a></li>
<li><a href="#h:1e0ee570-e509-4ecb-a3af-b75543731bb0">3.1.2. Switching to last used buffer</a></li>
<li><a href="#h:34506761-06b9-43b5-a818-506d9b3faf28">3.1.3. mu4e functions</a></li>
<li><a href="#h:4b9d74ef-0376-45bb-bc15-d24a04ca7e81">3.1.4. Create non-existant directories when finding file</a></li>
<li><a href="#h:91e2f45f-54fa-4b60-8758-b2ef9b439af7">3.1.5. [crux] Duplicate Lines</a></li>
<li><a href="#h:4819720a-9220-4c34-b903-ed4179f3ad1c">3.1.6. [prot] org-id-headings</a></li>
<li><a href="#h:285e5c0a-875d-46a8-bb9b-0222b3d73878">3.1.7. Inhibit Messages in Echo Area</a></li>
<li><a href="#h:de249f2a-6a2b-4114-8046-09d1014a7391">3.1.8. Move up one directory for find-file</a></li>
<li><a href="#h:06b77d28-3fd5-4554-8c7d-32c1b0ec8da5">3.1.9. org-mode: General setup</a></li>
<li><a href="#h:fa710375-2efe-49b4-af6a-a875aca6e4a2">3.1.10. org-mode: Visual-fill column</a></li>
<li><a href="#h:59d4306e-9b73-4b2c-b039-6a6518c357fc">3.1.11. org-mode: Auto-tangle and export Configuration Files</a></li>
<li><a href="#h:dfa66e78-5748-45e3-a975-db3da104bb3a">3.1.12. org-mode: Fold current heading</a></li>
<li><a href="#h:a1802f9b-bb71-4fd5-86fa-945da18e8b81">3.1.13. corfu: Do not interrupt navigation</a></li>
<li><a href="#org5fff398">3.1.14. python shell reloading</a></li>
</ul>
</li>
<li><a href="#h:2b827c27-0de7-45ed-9d9e-6c511e2c6bb5">3.2. Custom Keybindings</a></li>
<li><a href="#h:07951589-54ba-4e3e-bd7b-4106cd22ff6a">3.3. Directory setup</a></li>
<li><a href="#h:0cf30b76-91d9-41da-a10b-74199bc36d40">3.4. Unclutter .emacs.d</a></li>
<li><a href="#h:329f529a-ef9f-4787-b311-1c485e05b754">3.5. Move backup files to another location</a></li>
</ul>
</li>
<li><a href="#h:786b447d-03ad-4c1d-b114-c37caa2d591c">4. General init.el setup + UI</a>
<ul>
<li><a href="#h:76a5bd78-a20d-4068-bea8-a38fdb26428e">4.1. General setup</a></li>
<li><a href="#h:0debe8fd-b319-4ab7-a92c-784fa7896b75">4.2. Mark all themes as safe</a></li>
<li><a href="#h:b587e869-9911-443b-bc6d-8fb3ce31908d">4.3. Show less compilation warnings</a></li>
<li><a href="#h:6527b3ce-b76d-431a-9960-a57da7c53e1b">4.4. Indentation</a></li>
<li><a href="#h:3dc9fb1d-cd16-4bd0-a9ac-55a944415a90">4.5. Scrolling</a></li>
<li><a href="#h:5bf9f014-ee96-42da-b285-7b34f04e6bb1">4.6. Evil</a>
<ul>
<li><a href="#h:218376e8-086b-46bf-91b3-78295d5d440f">4.6.1. General evil</a></li>
<li><a href="#h:bde208f3-01ef-4dc6-9981-65f3d2a8189b">4.6.2. evil-collection</a></li>
<li><a href="#h:d80e3f7d-0185-4a15-832b-d756e576265c">4.6.3. evil-snipe</a></li>
<li><a href="#h:b06a378d-5248-4451-8eee-e65a3a768b1d">4.6.4. evil-cleverparens</a></li>
<li><a href="#h:aac82e5e-d882-4870-b644-ebdd0a2daae3">4.6.5. evil-surround</a></li>
</ul>
</li>
<li><a href="#h:e888d7a7-1755-4109-af11-5358b8cf140e">4.7. ispell</a></li>
<li><a href="#h:60f87342-0491-4c56-8057-6f075cf35753">4.8. Font Configuration</a></li>
<li><a href="#h:72a9704b-83d2-4b74-a1f6-d333203f62db">4.9. Theme</a></li>
<li><a href="#h:eb0ea526-a83a-4664-b3a1-2b40d3a31493">4.10. Icons</a></li>
<li><a href="#h:455ed7ac-ee7f-4f94-b857-f2c58b2282d0">4.11. Variable Pitch Mode</a></li>
<li><a href="#h:ed585848-875a-4673-910c-d2e1901dd95b">4.12. Modeline</a></li>
<li><a href="#h:39ae01e9-8053-4f76-aa77-8cbbbcff9652">4.13. Helper Modes</a>
<ul>
<li><a href="#h:b190d512-bfb5-42ec-adec-8d86bab726ce">4.13.1. Vertico, Orderless, Marginalia, Consult, Embark</a></li>
<li><a href="#h:cbf6bd48-2503-489a-89da-e3359564e989">4.13.2. Helpful + which-key: Better help defaults</a></li>
</ul>
</li>
<li><a href="#h:bbbd9cc8-3a84-4810-a3d5-b8536a5fbda1">4.14. Ligatures</a></li>
<li><a href="#h:e9d40e63-0e1f-47df-98f7-5427992588a4">4.15. Popup (popper) + Shackle Buffers</a></li>
<li><a href="#h:a6d23c8c-125f-4e36-af30-ff0a1e0d5a28">4.16. Indicate first and last line of buffer</a></li>
</ul>
</li>
<li><a href="#h:f2622fd3-7f14-47a8-8c21-33574fcbf14b">5. Modules</a>
<ul>
<li><a href="#h:99544398-72af-4382-b8e1-01b2221baff4">5.1. Org Mode</a>
<ul>
<li><a href="#h:877c9401-a354-4e44-a235-db1a90d19e00">5.1.1. General org-mode</a></li>
<li><a href="#h:2b3b4eb6-68a1-476d-b5d1-940a21484f1d">5.1.2. org-agenda</a></li>
<li><a href="#h:23183635-3d46-4d7d-8eda-e0a085b335ef">5.1.3. org capture templates</a></li>
<li><a href="#h:40528f5a-c8cd-471b-b862-4088e8e61860">5.1.4. Font Faces</a></li>
<li><a href="#h:62829574-a069-44b8-afb3-401a268d2747">5.1.5. org-appear</a></li>
<li><a href="#h:bbcfa895-4d46-4b1d-b84e-f634e982c46e">5.1.6. Centered org-mode Buffers</a></li>
<li><a href="#h:c1a0adea-ca97-43d7-b5a0-b856d2ebc9a8">5.1.7. Fix headings not folding sometimes</a></li>
<li><a href="#h:3e0b6da3-0497-4080-bb49-bab949c03bc4">5.1.8. Babel</a></li>
<li><a href="#h:4696e2fc-3296-47dc-8fc3-66912c329d4c">5.1.9. aucTex</a></li>
<li><a href="#h:406e5ecb-66f0-49bf-85ca-8b499f73ec5b">5.1.10. org-download</a></li>
<li><a href="#h:a02b1162-3e19-46f1-8efc-9f375971645c">5.1.11. org-fragtog</a></li>
<li><a href="#h:95b42e77-767c-4461-9ba8-b1c1cd18266c">5.1.12. org-modern</a></li>
<li><a href="#h:4e11a845-a7bb-4eb5-b4ce-5b2f52e07425">5.1.13. Presentations</a></li>
</ul>
</li>
<li><a href="#h:406c2ecc-0e3e-4d9f-9ae3-3eb1f8b87d1b">5.2. Nix Mode</a></li>
<li><a href="#h:50327461-a11b-4e81-830a-90febc720cfa">5.3. Markdown Mode</a>
<ul>
<li><a href="#h:734dc40a-a2c4-4839-b884-cb99b81aa6fe">5.3.1. Mode</a></li>
<li><a href="#h:8d90fe51-0b32-423a-a159-4f853bc29b68">5.3.2. LaTeX in Markdown</a></li>
</ul>
</li>
<li><a href="#h:65e69741-9860-4ed0-bbed-7b7be9a2a9d6">5.4. Olivetti</a></li>
<li><a href="#h:94d4a0dc-b0d7-4702-b760-beeaa6da2b8f">5.5. darkroom</a></li>
<li><a href="#h:87453f1c-8ea5-4d0a-862d-8973d5bc5405">5.6. Ripgrep</a></li>
<li><a href="#h:543641d0-02a9-459e-a2d6-96c8fcc06864">5.7. Tree-sitter</a></li>
<li><a href="#h:82ddeef2-99f8-465b-ba36-07c3eaad717b">5.8. direnv</a></li>
<li><a href="#h:efb3f0fd-e846-4df9-ba48-2e45d776f68f">5.9. avy</a></li>
<li><a href="#h:1c1821c6-98de-4079-a4f3-6ba6e6dcb668">5.10. crdt (Collaborative Editing)</a></li>
<li><a href="#h:d9a6cb44-736e-4608-951f-e928e1b757c0">5.11. devdocs</a></li>
<li><a href="#h:5cde5032-251e-4cc4-9202-b4ce996f92c2">5.12. Projectile</a></li>
<li><a href="#h:d2c7323d-f8c6-4f23-b70a-930e3e4ecce5">5.13. Magit</a></li>
<li><a href="#h:1a8585ed-d9f2-478f-a132-440ada1cde2c">5.14. Forge</a></li>
<li><a href="#h:cf5b0e6b-56a5-4a93-99fb-258eb7cb2eb4">5.15. git-timemachine</a></li>
<li><a href="#h:d9671ab7-a75a-47c6-a1f4-376d126c9b0a">5.16. Delimiters (brackets): rainbow-delimiters, highlight-parentheses</a></li>
<li><a href="#h:d1a32a69-2f9a-45ef-95fe-a00e3551dc94">5.17. rainbow-mode</a></li>
<li><a href="#h:5653d693-ecca-4c95-9633-66b9e3241070">5.18. Corfu</a></li>
<li><a href="#h:c3cc1c12-3ab8-42b7-be07-63f54eac397f">5.19. cape</a></li>
<li><a href="#h:3aa20438-edf6-4b13-a90d-3d5c51239c44">5.20. rust</a></li>
<li><a href="#h:b9b27a88-06f3-470b-a604-a20b2079bc26">5.21. Tramp</a></li>
<li><a href="#h:58415e95-8a7a-4517-acbb-5f1bb1028603">5.22. diff-hl</a></li>
<li><a href="#h:d60ce0b1-cabf-43f5-a236-a1e4b400d2f5">5.23. Commenting</a></li>
<li><a href="#h:9ec11ee4-2250-414a-87b5-73ee680a3a4a">5.24. yasnippet</a></li>
<li><a href="#org8a3df1c">5.25. eglot</a></li>
<li><a href="#org0d359ae">5.26. Breadcrumb</a></li>
<li><a href="#h:e9a30d0f-423f-4e85-af4b-f8560f1c1b53">5.27. Prevent breaking of hardlinks</a></li>
<li><a href="#h:0918557a-8463-430c-b8df-6546dea9abd0">5.28. Dirvish</a></li>
<li><a href="#h:b108dd3e-f34d-4ed3-98df-0bf9de055889">5.29. pdf-tools: pdf-viewer and support for dirvish</a></li>
<li><a href="#h:c15efae7-b884-4c97-8367-ccc7e7ed9ba8">5.30. Jupyter</a></li>
<li><a href="#h:1fc538d1-8c53-48b2-8652-66046f4bbbf8">5.31. undo-tree</a></li>
<li><a href="#h:b6c18dd0-3377-47ea-80c3-ac1486454e18">5.32. Hydra</a>
<ul>
<li><a href="#h:c5681884-7040-4b55-ab1b-5777631a0514">5.32.1. Text scaling</a></li>
</ul>
</li>
<li><a href="#h:fff816a0-6d70-4bda-abab-833345e51100">5.33. External Applications</a>
<ul>
<li><a href="#h:9335d32d-bf08-4601-820d-f3d1f33f876f">5.33.1. Obsidian</a></li>
<li><a href="#h:5854c9a6-1319-4961-a112-75b1bf2e1f69">5.33.2. Anki</a></li>
</ul>
</li>
<li><a href="#h:2f333330-b19d-4f64-85ea-146ff28667e8">5.34. Email + Calendar</a>
<ul>
<li><a href="#h:48fde614-7cd0-4764-a7ac-0dae60d8b65a">5.34.1. make sure mu4e is found</a></li>
<li><a href="#h:b92a18cf-eec3-4605-a8c2-37133ade3574">5.34.2. mu4e</a></li>
<li><a href="#h:43209eeb-5d46-472e-b7c2-58a3fb465199">5.34.3. mu4e-alert</a></li>
<li><a href="#h:c760f04e-622f-4b3e-8916-53ca8cce6edc">5.34.4. Calendar</a></li>
</ul>
</li>
<li><a href="#h:48f5be2b-b3d2-4276-bd49-2630733f23d5">5.35. Dashboard: emacs startup screen</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<b>This file has 16683 words and was last revised on 2024-06-20 01:55:44 +0200.</b>
</p>

<div id="outline-container-h:a86fe971-f169-4052-aacf-15e0f267c6cd" class="outline-2">
<h2 id="h:a86fe971-f169-4052-aacf-15e0f267c6cd"><span class="section-number-2">1.</span> Introduction (no code)</h2>
<div class="outline-text-2" id="text-h:a86fe971-f169-4052-aacf-15e0f267c6cd">
<p>
This is my Emacs literate configuration. It is part of a NixOS system that is fully declarative and can be found here:
</p>

<ul class="org-ul">
<li><a href="https:github.com/Swarsel/.dotfiles"><code>SwarselSystems</code> on github.com</a></li>
<li><a href="https:swagit.swarsel.win/Swarsel/.dotfiles"><code>SwarselSystems</code> on swagit.swarsel.win</a></li>
</ul>

<p>
The literate configuration lets me explain my choices to my future self as well as you, the reader. I go to great lengths to explain the choices for all configuration steps that I take in order for me to pay due diligence in crafting my setup, and not simply copying big chunks of other peoples code. Also, the literate configuration approach is very convenient to me as I only need to keep of (ideally) a single file to manage all of my configuration. I hope that this documentation will make it easier for beginners to get into Emacs and NixOS as I know it can be a struggle in the beginning.
</p>

<p>
Due to a NixOS specific setting, I currently manage two files (<code>Emacs.org</code> and <code>Nixos.org</code>), but I hope to soon find a way to consolidate them into a single file.
</p>

<p>
My emacs is built using the emacs-overlay nix flake, which builds a bleeding edge emacs on wayland (pgtk) with utilities like treesitter support. By executing the below source block, the current build setting can be updated at any time, and you can see my most up-to-date build options (last updated: 2024-06-20 01:55:44 +0200)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
system-configuration-options

</pre>
</div>

<pre class="example">
--prefix=/nix/store/lymgpfqr5dp1wc0khbcbhhjnxq8ccsy9-emacs-pgtk-20240521.0 --disable-build-details --with-modules --with-pgtk --with-compress-install --with-toolkit-scroll-bars --with-native-compilation --without-imagemagick --with-mailutils --without-small-ja-dic --with-tree-sitter --without-xinput2 --with-xwidgets --with-dbus --with-selinux
</pre>


<p>
This file is not loaded by Emacs directly as the configuration (even though this would be possible) - instead, it generates two more files:
</p>

<ul class="org-ul">
<li><code>early-init.el</code>
This file handle startup optimization and sets up the basic frame that I will be working in.</li>
<li><code>init.el</code>
This file handles the rest of the Emacs configuration.</li>
</ul>

<p>
By using the configuration offered by this file, the file you are reading right now (<code>Emacs.org</code>) will be freshly tangled on every file save. However, when you clone this configuration yourself and have not yet activated it, you need to tangle the file yourself. This can be done using the keybind <code>C-c C-v t</code>. Alternatively, execute the following block:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(org-babel-tangle)

</pre>
</div>

<p>
Lastly, you will notice there is no package system setup in this configuration. This is because packages are automatically handled on the NixOS side by parsing the <code>Emacs.org</code> file for package installs.
</p>
</div>
</div>
<div id="outline-container-h:2c331451-45ed-4592-9e00-d36b5bf31248" class="outline-2">
<h2 id="h:2c331451-45ed-4592-9e00-d36b5bf31248"><span class="section-number-2">2.</span> Initialization (early-init.el)</h2>
<div class="outline-text-2" id="text-h:2c331451-45ed-4592-9e00-d36b5bf31248">
<p>
In this section I handle my early init file; it takes care of frame-setup for emacsclient buffers.
</p>
</div>

<div id="outline-container-h:38e03b65-9dfc-4547-b27d-236664d7dc15" class="outline-3">
<h3 id="h:38e03b65-9dfc-4547-b27d-236664d7dc15"><span class="section-number-3">2.1.</span> Increase startup performance</h3>
<div class="outline-text-3" id="text-h:38e03b65-9dfc-4547-b27d-236664d7dc15">
<p>
First, I use some advice from doomemacs regarding garbace collection; here I make sure that during startup, the garbace collectur will not run, which will improve startup times. Now, that might not really be needed since I will usually only start the emacs server once during startup and then not touch it again, however, since I am building my emacs configuration using NixOS, there is some merit to this since I will usually need to restart the server once I rebuild my configuration.
</p>

<p>
Also, inspired by a setting I have seen in protesilaos' configuration, I apply the same idea to the <code>file-name-handler-alist</code> and <code>vc-handled-backends</code>.
</p>

<p>
In the end, we need to restore those values to values that will work during normal operation. For that, I add a hook to the startup function that will revert the values once Emacs has finished initialization.
</p>

<p>
Also packed into the hook function is the line <code>(fset 'epg-wait-for-status 'ignore)</code>. This line is needed at the end of the configuration in order to allow for my Yubikey to be used to encrypt and decrypt <code>.gpg</code> files. Without it, Emacs will just hang forever and basically crash.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defvar swarsel-file-name-handler-alist file-name-handler-alist)
(defvar swarsel-vc-handled-backends vc-handled-backends)

(setq gc-cons-threshold most-positive-fixnum
      gc-cons-percentage 0.6
      file-name-handler-alist nil
      vc-handled-backends nil)

(add-hook 'emacs-startup-hook
          (lambda ()
            (progn
              (setq gc-cons-threshold (* 1000 1000 8)
                    gc-cons-percentage 0.1
                    file-name-handler-alist swarsel-file-name-handler-alist
                    vc-handled-backends swarsel-vc-handled-backends)
              (fset 'epg-wait-for-status 'ignore)
              )))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:782b3632-afb2-4c67-8c46-ff94408aef5d" class="outline-3">
<h3 id="h:782b3632-afb2-4c67-8c46-ff94408aef5d"><span class="section-number-3">2.2.</span> Setup frames</h3>
<div class="outline-text-3" id="text-h:782b3632-afb2-4c67-8c46-ff94408aef5d">
<p>
Next, I will setup the basic frame for my emacs buffers. Note that I use a tiling window manager, so I do not need to hold myself up with sizing the windows myself. I also disable some GUI tools that I (like many others) do not find to be particularly useful. Also I inhibit many startup functions here, even though it does not affect me greatly since I use another solution for that.
</p>

<p>
We also make require immediate compilation of native code.
</p>

<p>
For the <code>default-frame-alist</code>, I used to also set <code>'(right-divider-width . 4)</code> and <code>'(bottom-divider-width . 4)</code>, but I did not like the look of the divider bar and usually know my splits anyways, so this is no longer set.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(tool-bar-mode 0)
(menu-bar-mode 0)
(scroll-bar-mode 0)

(setq frame-inhibit-implied-resize t
      ring-bell-function 'ignore
      use-dialog-box nil
      use-file-dialog nil
      use-short-answers t
      inhibit-startup-message t
      inhibit-splash-screen t
      inhibit-startup-screen t
      inhibit-x-resources t
      inhibit-startup-buffer-menu t
      inhibit-startup-echo-area-message user-login-name ; this needs to be set to the username or it will not have an effect
      comp-deferred-compilation nil ; compile all Elisp to native code immediately
      )

(setq-default left-margin-width 1
              right-margin-width 1)

(setq-default default-frame-alist
      (append
       (list
        '(undecorated . t) ; no title bar, borders etc.
        '(background-color . "#1D252C") ; load doom-citylight colors to avoid white flash
        '(foreground-color . "#A0B3C5") ; load doom-citylight colors to avoid white flash
        '(vertical-scroll-bars . nil)
        '(horizontal-scroll-bars . nil)
        '(internal-border-width . 5)
        '(tool-bar-lines . 0)
        '(menu-bar-lines . 0))))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:396c47f2-7e2f-4fad-ae71-6483bf7e3e42" class="outline-3">
<h3 id="h:396c47f2-7e2f-4fad-ae71-6483bf7e3e42"><span class="section-number-3">2.3.</span> Make C-i, C-m, C-[ available in graphic sessions</h3>
<div class="outline-text-3" id="text-h:396c47f2-7e2f-4fad-ae71-6483bf7e3e42">
<p>
By default, emacs binds
</p>
<ul class="org-ul">
<li><code>C-i</code> to the <code>TAB</code> key</li>
<li><code>C-m</code> to the <code>RET</code> key</li>
<li><code>C-[</code> to the <code>ECS</code> key</li>
</ul>

<p>
These keybinds exist to make Emacs work well in terminal mode. However, most of the time I am using Emacs in a graphic session, and I would hence like to have these keybinds available for personal use.
</p>

<p>
NOTE: To use these keybinds, you need to enclose the binding in angled brackets (<code>&lt;&gt;</code>). Then they can be used normally
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(add-hook
    'after-make-frame-functions
    (lambda (frame)
      (with-selected-frame frame
        (when (display-graphic-p)
          (define-key input-decode-map (kbd "C-i") [DUMMY-i])
          (define-key input-decode-map (kbd "C-[") [DUMMY-lsb])
          (define-key input-decode-map (kbd "C-m") [DUMMY-m])
          ))))




</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:601ba407-b906-4869-8ef6-67a9fc285fba" class="outline-2">
<h2 id="h:601ba407-b906-4869-8ef6-67a9fc285fba"><span class="section-number-2">3.</span> Personal settings</h2>
<div class="outline-text-2" id="text-h:601ba407-b906-4869-8ef6-67a9fc285fba">
<p>
This section is used to define my own functions, own variables, and own keybindings.
</p>
</div>

<div id="outline-container-h:b7b5976a-db2b-493d-8794-1924a0e12aec" class="outline-3">
<h3 id="h:b7b5976a-db2b-493d-8794-1924a0e12aec"><span class="section-number-3">3.1.</span> Custom functions</h3>
<div class="outline-text-3" id="text-h:b7b5976a-db2b-493d-8794-1924a0e12aec">
<p>
In this section I define extra functions that I need. Some of these functions I wrote myself, some I found after internet reseach. For functions I found on the internet, I will link the original source I found it in.
</p>
</div>

<div id="outline-container-h:b715d7cf-da09-4e0c-95bc-8281b4f3ce9c" class="outline-4">
<h4 id="h:b715d7cf-da09-4e0c-95bc-8281b4f3ce9c"><span class="section-number-4">3.1.1.</span> Emacs/Evil state toggle</h4>
<div class="outline-text-4" id="text-h:b715d7cf-da09-4e0c-95bc-8281b4f3ce9c">
<p>
Since I am rebinding the <code>C-z</code> hotkey for emacs-evil-state toggling, I want to have a function that still lets me perform this action quickly.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun swarsel/toggle-evil-state ()
  (interactive)
  (if (or (evil-emacs-state-p) (evil-insert-state-p))
      (evil-normal-state)
    (evil-emacs-state)))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:1e0ee570-e509-4ecb-a3af-b75543731bb0" class="outline-4">
<h4 id="h:1e0ee570-e509-4ecb-a3af-b75543731bb0"><span class="section-number-4">3.1.2.</span> Switching to last used buffer</h4>
<div class="outline-text-4" id="text-h:1e0ee570-e509-4ecb-a3af-b75543731bb0">
<p>
I often find myself bouncing between two buffers when I do not want to use a window split. This funnction simply jumps to the last used buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun swarsel/last-buffer () (interactive) (switch-to-buffer nil))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:34506761-06b9-43b5-a818-506d9b3faf28" class="outline-4">
<h4 id="h:34506761-06b9-43b5-a818-506d9b3faf28"><span class="section-number-4">3.1.3.</span> mu4e functions</h4>
<div class="outline-text-4" id="text-h:34506761-06b9-43b5-a818-506d9b3faf28">
<p>
I use these functions to let me switch between my main email accounts, as mu4e by itself has trouble doing so. <code>mu4e-switch-account</code> allows for manual choosing of the sender account, while <code>mu4e-rfs--matching-address</code> and <code>mu4e-send-from-correct-address</code> are used when replying to a mail; they switch the sender account to the one that received the mail.
</p>

<p>
By default, the sender email will not be changed after sending a mail; however, I want Emacs to always use my main address when not replying to another email. For that I use <code>mu4e-restore-default</code>.
</p>

<p>
Used here: <a href="#h:b92a18cf-eec3-4605-a8c2-37133ade3574">mu4e</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun swarsel/mu4e-switch-account ()
  (interactive)
  (let ((account (completing-read "Select account: " mu4e-user-mail-address-list)))
    (setq user-mail-address account)))

(defun swarsel/mu4e-rfs--matching-address ()
  (cl-loop for to-data in (mu4e-message-field mu4e-compose-parent-message :to)
           for to-email = (pcase to-data
                            (`(_ . email) email)
                            (x (mu4e-contact-email x)))
           for to-name =  (pcase to-data
                            (`(_ . name) name)
                            (x (mu4e-contact-name x)))
           when (mu4e-user-mail-address-p to-email)
           return (list to-name to-email)))

(defun swarsel/mu4e-send-from-correct-address ()
  (when mu4e-compose-parent-message
    (save-excursion
      (when-let ((dest (swarsel/mu4e-rfs--matching-address)))
        (cl-destructuring-bind (from-user from-addr) dest
          (setq user-mail-address from-addr)
          (message-position-on-field "From")
          (message-beginning-of-line)
          (delete-region (point) (line-end-position))
          (insert (format "%s &lt;%s&gt;" (or from-user user-full-name) from-addr)))))))

(defun swarsel/mu4e-restore-default ()
  (setq user-mail-address "leon@swarsel.win"
        user-full-name "Leon Schwarzäugl"))


</pre>
</div>
</div>
</div>
<div id="outline-container-h:4b9d74ef-0376-45bb-bc15-d24a04ca7e81" class="outline-4">
<h4 id="h:4b9d74ef-0376-45bb-bc15-d24a04ca7e81"><span class="section-number-4">3.1.4.</span> Create non-existant directories when finding file</h4>
<div class="outline-text-4" id="text-h:4b9d74ef-0376-45bb-bc15-d24a04ca7e81">
<p>
This function will check if a directory for which a file we want to open exists; if not, it will offer to create the directories for me.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun swarsel/with-buffer-name-prompt-and-make-subdirs ()
  (let ((parent-directory (file-name-directory buffer-file-name)))
    (when (and (not (file-exists-p parent-directory))
               (y-or-n-p (format "Directory `%s' does not exist! Create it? " parent-directory)))
      (make-directory parent-directory t))))

(add-to-list 'find-file-not-found-functions #'swarsel/with-buffer-name-prompt-and-make-subdirs)

</pre>
</div>
</div>
</div>
<div id="outline-container-h:91e2f45f-54fa-4b60-8758-b2ef9b439af7" class="outline-4">
<h4 id="h:91e2f45f-54fa-4b60-8758-b2ef9b439af7"><span class="section-number-4">3.1.5.</span> [crux] Duplicate Lines</h4>
<div class="outline-text-4" id="text-h:91e2f45f-54fa-4b60-8758-b2ef9b439af7">
<p>
When programming, I like to be able to duplicate a line. There are easier functions than the one below, but they either
</p>

<ol class="org-ol">
<li>screw with undo/redo</li>
<li>move the cursor wildly</li>
</ol>

<p>
The below function avoids these problems. Originally I used the function <code>duplicate-line</code> found here: <a href="https://stackoverflow.com/questions/88399/how-do-i-duplicate-a-whole-line-in-emacs">https://stackoverflow.com/questions/88399/how-do-i-duplicate-a-whole-line-in-emacs</a>
</p>

<p>
However, this function does not work on regions. Later, I found a solution implemented by <a href="https://github.com/bbatsov/crux">crux</a>. I do not need the whole package, so I just extracted the three functions I needed from it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun crux-get-positions-of-line-or-region ()
  "Return positions (beg . end) of the current line or region."
  (let (beg end)
    (if (and mark-active (&gt; (point) (mark)))
        (exchange-point-and-mark))
    (setq beg (line-beginning-position))
    (if mark-active
        (exchange-point-and-mark))
    (setq end (line-end-position))
    (cons beg end)))

(defun crux-duplicate-current-line-or-region (arg)
    "Duplicates the current line or region ARG times.
  If there's no region, the current line will be duplicated.  However, if
  there's a region, all lines that region covers will be duplicated."
    (interactive "p")
    (pcase-let* ((origin (point))
                 (`(,beg . ,end) (crux-get-positions-of-line-or-region))
                 (region (buffer-substring-no-properties beg end)))
      (dotimes (_i arg)
        (goto-char end)
        (newline)
        (insert region)
        (setq end (point)))
      (goto-char (+ origin (* (length region) arg) arg))))

(defun crux-duplicate-and-comment-current-line-or-region (arg)
  "Duplicates and comments the current line or region ARG times.
If there's no region, the current line will be duplicated.  However, if
there's a region, all lines that region covers will be duplicated."
  (interactive "p")
  (pcase-let* ((origin (point))
               (`(,beg . ,end) (crux-get-positions-of-line-or-region))
               (region (buffer-substring-no-properties beg end)))
    (comment-or-uncomment-region beg end)
    (setq end (line-end-position))
    (dotimes (_ arg)
      (goto-char end)
      (newline)
      (insert region)
      (setq end (point)))
    (goto-char (+ origin (* (length region) arg) arg))))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:4819720a-9220-4c34-b903-ed4179f3ad1c" class="outline-4">
<h4 id="h:4819720a-9220-4c34-b903-ed4179f3ad1c"><span class="section-number-4">3.1.6.</span> [prot] org-id-headings</h4>
<div class="outline-text-4" id="text-h:4819720a-9220-4c34-b903-ed4179f3ad1c">
<p>
These functions by protesilaos generate heading links in an org-file similar to the normal <code>org-store-link</code> approach when not using properties. This approach has a weakness however - if the heading name is changed, the link breaks. These functions generate a unique identifier for each heading which will not break and also works when exporting the file to html, for example.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun prot-org--id-get ()
  "Get the CUSTOM_ID of the current entry.
If the entry already has a CUSTOM_ID, return it as-is, else
create a new one."
  (let* ((pos (point))
         (id (org-entry-get pos "CUSTOM_ID")))
    (if (and id (stringp id) (string-match-p "\\S-" id))
        id
      (setq id (org-id-new "h"))
      (org-entry-put pos "CUSTOM_ID" id)
      id)))

(declare-function org-map-entries "org")

(defun prot-org-id-headlines ()
  "Add missing CUSTOM_ID to all headlines in current file."
  (interactive)
  (org-map-entries
   (lambda () (prot-org--id-get))))

(defun prot-org-id-headline ()
  "Add missing CUSTOM_ID to headline at point."
  (interactive)
  (prot-org--id-get))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:285e5c0a-875d-46a8-bb9b-0222b3d73878" class="outline-4">
<h4 id="h:285e5c0a-875d-46a8-bb9b-0222b3d73878"><span class="section-number-4">3.1.7.</span> Inhibit Messages in Echo Area</h4>
<div class="outline-text-4" id="text-h:285e5c0a-875d-46a8-bb9b-0222b3d73878">
<p>
Emacs likes to send messages to the echo area; this is generally a good thing. However, it bothers me a lot when I am currently working in minibuffer where I receive an echo area message that is actually important and it is then overwritten by e.g. the mu4e update message. This section makes it possible to find the root function calling the message function and disabling it here.
</p>

<p>
Usage: Enable the <code>(advice-add 'message :around #'who-called-me?)</code> by running this code block, which will show a full trace of all messages being sent to the echo area:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(advice-add 'message :around #'who-called-me?)

</pre>
</div>

<p>
Once the root function has been found, it can be disabled via <code>advice=add</code> as in the last block in this section. To disable the stack tracing, run <code>(advice-remove 'message #'who-called-me?)</code> or the following code block:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(advice-remove 'message #'who-called-me?)

</pre>
</div>

<p>
Lastly, individual messages can be reenabled using the <code>(advice-remove '&lt;FUNCTION-NAME&gt; #'suppress-messages)</code> approach. Use this when you accidentally disabled a helpful message.
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun suppress-messages (old-fun &amp;rest args)
  (cl-flet ((silence (&amp;rest args1) (ignore)))
    (advice-add 'message :around #'silence)
    (unwind-protect
        (apply old-fun args)
      (advice-remove 'message #'silence))))

(advice-add 'pixel-scroll-precision :around #'suppress-messages)
(advice-add 'mu4e--server-filter :around #'suppress-messages)
(advice-add 'org-unlogged-message :around #'suppress-messages)
(advice-add 'magit-auto-revert-mode--init-kludge  :around #'suppress-messages)
(advice-add 'push-mark  :around #'suppress-messages)

;; to reenable
;; (advice-remove 'timer-event-handler #'suppress-messages)

(defun who-called-me? (old-fun format &amp;rest args)
  (let ((trace nil) (n 1) (frame nil))
    (while (setf frame (backtrace-frame n))
      (setf n     (1+ n)
            trace (cons (cadr frame) trace)) )
    (apply old-fun (concat "&lt;&lt;%S&gt;&gt;\n" format) (cons trace args))))

;; enable to get message backtrace, the first function shown in backtrace calls the other functions
;; (advice-add 'message :around #'who-called-me?)

;; disable to stop receiving backtrace
(advice-remove 'message #'who-called-me?)


</pre>
</div>
</div>
</div>
<div id="outline-container-h:de249f2a-6a2b-4114-8046-09d1014a7391" class="outline-4">
<h4 id="h:de249f2a-6a2b-4114-8046-09d1014a7391"><span class="section-number-4">3.1.8.</span> Move up one directory for find-file</h4>
<div class="outline-text-4" id="text-h:de249f2a-6a2b-4114-8046-09d1014a7391">
<p>
I find it very annoying that the standard behavior for M-DEL only deletes one word when using find-file. This function makes it so that we always go up by one directory level instead.
</p>

<p>
This function was found here: <a href="https://www.reddit.com/r/emacs/comments/re31i6/how_to_go_up_one_directory_when_using_findfile_cx/">https://www.reddit.com/r/emacs/comments/re31i6/how_to_go_up_one_directory_when_using_findfile_cx/</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun up-directory (path)
  "Move up a directory in PATH without affecting the kill buffer."
  (interactive "p")
  (if (string-match-p "/." (minibuffer-contents))
      (let ((end (point)))
        (re-search-backward "/.")
        (forward-char)
        (delete-region (point) end))))

(define-key minibuffer-local-filename-completion-map
            [C-backspace] #'up-directory)

</pre>
</div>
</div>
</div>
<div id="outline-container-h:06b77d28-3fd5-4554-8c7d-32c1b0ec8da5" class="outline-4">
<h4 id="h:06b77d28-3fd5-4554-8c7d-32c1b0ec8da5"><span class="section-number-4">3.1.9.</span> org-mode: General setup</h4>
<div class="outline-text-4" id="text-h:06b77d28-3fd5-4554-8c7d-32c1b0ec8da5">
<p>
Sets up the basic settings that I want to have active in org-mode buffers.
</p>

<p>
Used here: <a href="#h:877c9401-a354-4e44-a235-db1a90d19e00">General org-mode</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun swarsel/org-mode-setup ()
  (org-indent-mode)
  (variable-pitch-mode 1)
  ;;(auto-fill-mode 0)
  (setq display-line-numbers-type 'relative
        display-line-numbers-current-absolute 1
        display-line-numbers-width-start nil
        display-line-numbers-width 6
        display-line-numbers-grow-only 1)
  (add-hook 'org-tab-first-hook 'org-end-of-line)
  (visual-line-mode 1))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:fa710375-2efe-49b4-af6a-a875aca6e4a2" class="outline-4">
<h4 id="h:fa710375-2efe-49b4-af6a-a875aca6e4a2"><span class="section-number-4">3.1.10.</span> org-mode: Visual-fill column</h4>
<div class="outline-text-4" id="text-h:fa710375-2efe-49b4-af6a-a875aca6e4a2">
<p>
This function sets the width of buffers in org-mode.
</p>

<p>
Used in: <a href="#h:bbcfa895-4d46-4b1d-b84e-f634e982c46e">Centered org-mode Buffers</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun swarsel/org-mode-visual-fill ()
  (setq visual-fill-column-width 150
        visual-fill-column-center-text t)
  (visual-fill-column-mode 1))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:59d4306e-9b73-4b2c-b039-6a6518c357fc" class="outline-4">
<h4 id="h:59d4306e-9b73-4b2c-b039-6a6518c357fc"><span class="section-number-4">3.1.11.</span> org-mode: Auto-tangle and export Configuration Files</h4>
<div class="outline-text-4" id="text-h:59d4306e-9b73-4b2c-b039-6a6518c357fc">
<p>
This section automatically tangles all configuration blocks in this file to the defined Emacs org-file. It also exports the configuration file as html.
</p>



<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun swarsel/org-babel-tangle-config ()
  (when (string-equal (buffer-file-name)
                      swarsel-emacs-org-filepath)
    ;; Dynamic scoping to the rescue
    (let ((org-confirm-babel-evaluate nil))
      (org-html-export-to-html)
      (org-babel-tangle)))
  (when (string-equal (buffer-file-name)
                      swarsel-nix-org-filepath)
    ;; Dynamic scoping to the rescue
    (let ((org-confirm-babel-evaluate nil))
      (org-babel-tangle))))

(setq org-html-htmlize-output-type nil)

(add-hook 'org-mode-hook (lambda () (add-hook 'after-save-hook #'swarsel/org-babel-tangle-config)))



</pre>
</div>
</div>
</div>

<div id="outline-container-h:dfa66e78-5748-45e3-a975-db3da104bb3a" class="outline-4">
<h4 id="h:dfa66e78-5748-45e3-a975-db3da104bb3a"><span class="section-number-4">3.1.12.</span> org-mode: Fold current heading</h4>
<div class="outline-text-4" id="text-h:dfa66e78-5748-45e3-a975-db3da104bb3a">
<p>
Normally emacs cycles between three states:
</p>

<ol class="org-ol">
<li>fully folded</li>
<li>One heading expanded</li>
<li>All headings expanded</li>
</ol>

<p>
However, I want to be able to fold a single heading consistently.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun org-fold-outer ()
  (interactive)
  (org-beginning-of-line)
  (if (string-match "^*+" (thing-at-point 'line t))
      (outline-up-heading 1))
  (outline-hide-subtree)
  )

</pre>
</div>
</div>
</div>

<div id="outline-container-h:a1802f9b-bb71-4fd5-86fa-945da18e8b81" class="outline-4">
<h4 id="h:a1802f9b-bb71-4fd5-86fa-945da18e8b81"><span class="section-number-4">3.1.13.</span> corfu: Do not interrupt navigation</h4>
<div class="outline-text-4" id="text-h:a1802f9b-bb71-4fd5-86fa-945da18e8b81">
<p>
These three functions allow me to keep using the normal navigation keys even when a corfu completion pops up.
</p>

<p>
These functions are used here: <a href="#h:5653d693-ecca-4c95-9633-66b9e3241070">Corfu</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun swarsel/corfu-normal-return (&amp;optional arg)
  (interactive)
  (corfu-quit)
  (newline)
  )

(defun swarsel/corfu-quit-and-up (&amp;optional arg)
  (interactive)
  (corfu-quit)
  (evil-previous-visual-line))

(defun swarsel/corfu-quit-and-down (&amp;optional arg)
  (interactive)
  (corfu-quit)
  (evil-next-visual-line))

</pre>
</div>
</div>
</div>

<div id="outline-container-org5fff398" class="outline-4">
<h4 id="org5fff398"><span class="section-number-4">3.1.14.</span> python shell reloading</h4>
<div class="outline-text-4" id="text-3-1-14">
<p>
The standard Emacs behaviour for the Python process shell is a bit annoying. This is my attempt at making it show automatically on opening a python buffer and making it refresh on its own as well. This does not nicely work yet.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
    ;; run the python inferior shell immediately upon entering a python buffer
    ;; (add-hook 'python-mode-hook 'swarsel/run-python)

  ;; (defun swarsel/run-python ()
  ;;   (save-selected-window
  ;;     (switch-to-buffer-other-window (process-buffer (python-shell-get-or-create-process (python-shell-parse-command))))))

;; reload python shell automatically
(defun my-python-shell-run ()
  (interactive)
  (when (get-buffer-process "*Python*")
     (set-process-query-on-exit-flag (get-buffer-process "*Python*") nil)
     (kill-process (get-buffer-process "*Python*"))
     ;; Uncomment If you want to clean the buffer too.
     ;;(kill-buffer "*Python*")
     ;; Not so fast!
     (sleep-for 0.5))
  (run-python (python-shell-parse-command) nil nil)
  (python-shell-send-buffer)
  ;; Pop new window only if shell isnt visible
  ;; in any frame.
  (unless (get-buffer-window "*Python*" t)
    (python-shell-switch-to-shell)))

(defun my-python-shell-run-region ()
  (interactive)
  (python-shell-send-region (region-beginning) (region-end))
  (python-shell-switch-to-shell))

</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-h:2b827c27-0de7-45ed-9d9e-6c511e2c6bb5" class="outline-3">
<h3 id="h:2b827c27-0de7-45ed-9d9e-6c511e2c6bb5"><span class="section-number-3">3.2.</span> Custom Keybindings</h3>
<div class="outline-text-3" id="text-h:2b827c27-0de7-45ed-9d9e-6c511e2c6bb5">
<p>
This defines a set of keybinds that I want to have available globally. I have one set of keys that is globally available through the <code>C-SPC</code> prefix. This set is used mostly for functions that I have trouble remembering the original keybind for, or that I just want to have gathered in a common space.
</p>

<p>
I also define some keybinds to some combinations directly. Those are used mostly for custom functions that I call often enough to warrant this.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; Make ESC quit prompts
(global-set-key (kbd "&lt;escape&gt;") 'keyboard-escape-quit)

;; Set up general keybindings
(use-package general
  :config
  (general-create-definer swarsel/leader-keys
    :keymaps '(normal insert visual emacs)
    :prefix "SPC"
    :global-prefix "C-SPC")

  (swarsel/leader-keys
    "e"  '(:ignore e :which-key "evil")
    "eo" '(evil-jump-backward :which-key "cursor jump backwards")
    "eO" '(evil-jump-forward :which-key "cursor jump forwards")
    "t"  '(:ignore t :which-key "toggles")
    "ts" '(hydra-text-scale/body :which-key "scale text")
    "te" '(swarsel/toggle-evil-state :which-key "emacs/evil")
    "tl" '(display-line-numbers-mode :which-key "line numbers")
    "tp" '(evil-cleverparens-mode :wk "cleverparens")
    "to" '(olivetti-mode :wk "olivetti")
    "td" '(darkroom-tentative-mode :wk "darkroom")
    "tw" '((lambda () (interactive) (toggle-truncate-lines)) :which-key "line wrapping")
    "m"  '(:ignore m :which-key "modes/programs")
    "mm" '((lambda () (interactive) (mu4e)) :which-key "mu4e")
    "mg" '((lambda () (interactive) (magit-list-repositories)) :which-key "magit-list-repos")
    "mc" '((lambda () (interactive) (swarsel/open-calendar)) :which-key "calendar")
    "mp" '(popper-toggle :which-key "popper")
    "md" '(dirvish :which-key "dirvish")
    "o"  '(:ignore o :which-key "org")
    "op" '((lambda () (interactive) (org-present)) :which-key "org-present")
    "ob" '((lambda () (interactive) (org-babel-mark-block)) :which-key "Mark whole src-block")
    "ol" '((lambda () (interactive) (org-insert-link)) :which-key "insert link")
    "os" '((lambda () (interactive) (org-store-link)) :which-key "store link")
    "od" '((lambda () (interactive) (org-babel-demarcate-block)) :which-key "demarcate (split) src-block")
    ;; "c"  '(:ignore c :which-key "capture")
    ;; "cj" '((lambda () (interactive) (org-capture nil "jj")) :which-key "journal")
    ;; "cs" '(markdown-download-screenshot :which-key "screenshot")
    "l"  '(:ignore l :which-key "links")
    "le" '((lambda () (interactive) (find-file swarsel-emacs-org-filepath)) :which-key "Emacs.org")
    "ls" '((lambda () (interactive) (find-file "/smb:Swarsel@192.168.1.3:")) :which-key "Server")
    "lo" '(dired swarsel-obsidian-vault-directory :which-key "obsidian")
    ;; "la" '((lambda () (interactive) (find-file swarsel-org-anki-filepath)) :which-key "anki")
    "ln" '((lambda () (interactive) (find-file swarsel-nix-org-filepath)) :which-key "Nix.org")
    "lp" '((lambda () (interactive) (projectile-switch-project)) :which-key "switch project")
    "lg" '((lambda () (interactive) (magit-list-repositories)) :which-key "list git repos")
    ;; "a"   '(:ignore a :which-key "anki")
    ;; "ap"  '(anki-editor-push-tree :which-key "push new cards")
    ;; "an"  '((lambda () (interactive) (org-capture nil "a")) :which-key "new card")
    ;; "as"  '(swarsel-anki-set-deck-and-notetype :which-key "change deck and notetype")
    "h"   '(:ignore h :which-key "help")
    "hy"  '(yas-describe-tables :which-key "yas tables")
    "hb"  '(embark-bindings :which-key "current key bindings")
    "h"   '(:ignore t :which-key "describe")
    "he"  'view-echo-area-messages
    "hf"  'describe-function
    "hF"  'describe-face
    "hl"  '(view-lossage :which-key "show command keypresses")
    "hL"  'find-library
    "hm"  'describe-mode
    "ho"  'describe-symbol
    "hk"  'describe-key
    "hK"  'describe-keymap
    "hp"  'describe-package
    "hv"  'describe-variable
    "hd"  'devdocs-lookup
    "w"   '(:ignore t :which-key "window")
    "wl"  'windmove-right
    "wh"  'windmove-left
    "wk"  'windmove-up
    "wj"  'windmove-down
    "wr"  'winner-redo
    "wd"  'delete-window
    "w="  'balance-windows-area
    "wD"  'kill-buffer-and-window
    "wu"  'winner-undo
    "wr"  'winner-redo
    "w/"  'evil-window-vsplit
    "w-"  'evil-window-split
    "wm"  '(delete-other-windows :wk "maximize")
    ))

;; General often used hotkeys
(general-define-key
 "C-M-a" (lambda () (interactive) (org-capture nil "a")) ; make new anki card
 ;; "C-M-d" 'swarsel-obsidian-daily ; open daily obsidian file and create if not exist
 ;; "C-M-S" 'swarsel-anki-set-deck-and-notetype ; switch deck and notetype for new anki cards
 ;; "C-M-s" 'markdown-download-screenshot ; wrapper for org-download-screenshot
 "C-c d" 'crux-duplicate-current-line-or-region
 "C-c D" 'crux-duplicate-and-comment-current-line-or-region
 "&lt;DUMMY-m&gt;" 'swarsel/last-buffer
 "M-\\" 'indent-region
 "C-&lt;f9&gt;" 'my-python-shell-run
 )

</pre>
</div>
</div>
</div>
<div id="outline-container-h:07951589-54ba-4e3e-bd7b-4106cd22ff6a" class="outline-3">
<h3 id="h:07951589-54ba-4e3e-bd7b-4106cd22ff6a"><span class="section-number-3">3.3.</span> Directory setup</h3>
<div class="outline-text-3" id="text-h:07951589-54ba-4e3e-bd7b-4106cd22ff6a">
<p>
In this section I setup some aliases that I use for various directories on my system. Some of these are actually used for magit repository finding etc., but many of them serve no real use and I need to clean this up someday.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; set Nextcloud directory for journals etc.
(setq swarsel-sync-directory "~/Nextcloud"
      swarsel-emacs-directory "~/.emacs.d"
      swarsel-dotfiles-directory "~/.dotfiles"
      swarsel-projects-directory "~/Documents/GitHub")

(setq swarsel-emacs-org-filepath (expand-file-name "Emacs.org" swarsel-dotfiles-directory)
      swarsel-nix-org-filepath (expand-file-name "Nix.org" swarsel-dotfiles-directory))


;; set Emacs main configuration .org names
(setq swarsel-emacs-org-file "Emacs.org"
      swarsel-anki-org-file "Anki.org"
      swarsel-tasks-org-file "Tasks.org"
      swarsel-archive-org-file "Archive.org"
      swarsel-org-folder-name "Org"
      swarsel-obsidian-daily-folder-name "⭐ Personal/Journal"
      swarsel-obsidian-folder-name "Obsidian"
      swarsel-obsidian-vault-name "Main")


;; set directory paths
(setq swarsel-org-directory (expand-file-name swarsel-org-folder-name  swarsel-sync-directory)) ; path to org folder
(setq swarsel-obsidian-directory (expand-file-name swarsel-obsidian-folder-name swarsel-sync-directory)) ; path to obsidian
(setq swarsel-obsidian-vault-directory (expand-file-name swarsel-obsidian-vault-name swarsel-obsidian-directory)) ; path to obsidian vault
(setq swarsel-obsidian-daily-directory (expand-file-name swarsel-obsidian-daily-folder-name swarsel-obsidian-vault-directory)) ; path to obsidian daily folder

;; filepaths to certain documents
(setq swarsel-org-anki-filepath (expand-file-name swarsel-anki-org-file swarsel-org-directory) ; path to anki export file
      swarsel-org-tasks-filepath (expand-file-name swarsel-tasks-org-file swarsel-org-directory)
      swarsel-org-archive-filepath (expand-file-name swarsel-archive-org-file swarsel-org-directory))

;; set paths to authentication files (forge)
;; (setq auth-source-pass-filename "~/.local/share/password-store"
(setq auth-sources '( "~/.emacs.d/.caldav" "~/.emacs.d/.authinfo.gpg")
      auth-source-cache-expiry nil) ; default is 2h



</pre>
</div>
</div>
</div>

<div id="outline-container-h:0cf30b76-91d9-41da-a10b-74199bc36d40" class="outline-3">
<h3 id="h:0cf30b76-91d9-41da-a10b-74199bc36d40"><span class="section-number-3">3.4.</span> Unclutter .emacs.d</h3>
<div class="outline-text-3" id="text-h:0cf30b76-91d9-41da-a10b-74199bc36d40">
<p>
In this section I move the <code>custom.el</code> out of it's standard location in <code>.emacs.d</code>. Firstly, I dislike using this file at all since I would rather have fully stateful configuration as commanded by this file. Secondly, this file is too easily permanently changed. Recently I figured out the last bits that I needed to remove from custom.el to no longer be reliant on it, so I now just write it to a temporary file (through <code>make-temp=file</code>) which will be cleaned on shutdown. However, I like to retain the custom framework because it is nice for testing out theme customizations, hence why I still load the file.
</p>

<p>
This section also sets the emacs directory to the <code>~/.cache/</code> directory which is useful for files that I do not want to have lying around in my <code>.emacs.d</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; Change the user-emacs-directory to keep unwanted things out of ~/.emacs.d
(setq user-emacs-directory (expand-file-name "~/.cache/emacs/")
      url-history-file (expand-file-name "url/history" user-emacs-directory))

;; Use no-littering to automatically set common paths to the new user-emacs-directory
(use-package no-littering)
(setq custom-file (make-temp-file "emacs-custom-"))
(load custom-file t)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:329f529a-ef9f-4787-b311-1c485e05b754" class="outline-3">
<h3 id="h:329f529a-ef9f-4787-b311-1c485e05b754"><span class="section-number-3">3.5.</span> Move backup files to another location</h3>
<div class="outline-text-3" id="text-h:329f529a-ef9f-4787-b311-1c485e05b754">
<p>
Many people dislike the Emacs backup files; I do enjoy them, but have to admit that they clutter the filesystem a little too much. Also, I rarely need to access these over different sessions. Hence I move them to <code>/tmp</code> - if Emacs unexpectedly crashes, the files can be recovered, but the backup files will not gather everywhere and will be deleted upon shutdown.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(let ((backup-dir "~/tmp/emacs/backups")
      (auto-saves-dir "~/tmp/emacs/auto-saves/"))
  (dolist (dir (list backup-dir auto-saves-dir))
    (when (not (file-directory-p dir))
      (make-directory dir t)))
  (setq backup-directory-alist `(("." . ,backup-dir))
        auto-save-file-name-transforms `((".*" ,auto-saves-dir t))
        auto-save-list-file-prefix (concat auto-saves-dir ".saves-")
        tramp-backup-directory-alist `((".*" . ,backup-dir))
        tramp-auto-save-directory auto-saves-dir))

(setq backup-by-copying t    ; Don't delink hardlinks
      delete-old-versions t  ; Clean up the backups
      version-control t      ; Use version numbers on backups,
      kept-new-versions 5    ; keep some new versions
      kept-old-versions 2)   ; and some old ones, too

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:786b447d-03ad-4c1d-b114-c37caa2d591c" class="outline-2">
<h2 id="h:786b447d-03ad-4c1d-b114-c37caa2d591c"><span class="section-number-2">4.</span> General init.el setup + UI</h2>
<div class="outline-text-2" id="text-h:786b447d-03ad-4c1d-b114-c37caa2d591c">
<p>
In this general section I have settings that I either consider to be integral to my experience when using emacs or have no other section that I feel they belong to.
</p>
</div>

<div id="outline-container-h:76a5bd78-a20d-4068-bea8-a38fdb26428e" class="outline-3">
<h3 id="h:76a5bd78-a20d-4068-bea8-a38fdb26428e"><span class="section-number-3">4.1.</span> General setup</h3>
<div class="outline-text-3" id="text-h:76a5bd78-a20d-4068-bea8-a38fdb26428e">
<p>
Here I set up some things that are too minor to put under other categories.
</p>
<ul class="org-ul">
<li>Firstly we disable to having to type `yes` and `no` and switch it to `y` and `n`.</li>
<li>We also enable the marking of trailing whitespaces.</li>
<li>Also, make emacs highlight the current line globally</li>
<li>Emacs defaults to pausing all display redrawing on any input. This may have been useful previously, but is not necessary nowadays.</li>
<li>I also disable the suspend-frame function, as I never use it and it is quite confusing when accidentally hitting the keys for it.</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; use UTF-8 everywhere
(set-language-environment "UTF-8")

;; set default font size
(defvar swarsel/default-font-size 130)
(setq swarsel-standard-font "FiraCode Nerd Font Mono"
      swarsel-alt-font "FiraCode Nerd Font Mono")

;; (defalias 'yes-or-no-p 'y-or-n-p)
;;(setq-default show-trailing-whitespace t)
(add-hook 'before-save-hook 'delete-trailing-whitespace)
(global-hl-line-mode 1)
;; (setq redisplay-dont-pause t) ;; obsolete
(setq blink-cursor-mode nil) ;; blink-cursor is an unexpected source of slowdown
(global-subword-mode 1) ; Iterate through CamelCase words
(setq blink-matching-paren nil) ;; this makes the cursor jump around annoyingly
(delete-selection-mode 1)
(setq vc-follow-symlinks t)
(setq require-final-newline t)
(winner-mode 1)
(setq load-prefer-newer t)

(setq undo-limit 80000000
      evil-want-fine-undo t
      auto-save-default t
      password-cache-expiry nil
      )
(setq browse-url-browser-function 'browse-url-firefox)
;; disable a keybind that does more harm than good
(global-set-key [remap suspend-frame]
                (lambda ()
                  (interactive)
                  (message "This keybinding is disabled (was 'suspend-frame')")))

(setq visible-bell nil)
(setq initial-major-mode 'fundamental-mode
      initial-scratch-message nil)

(add-hook 'prog-mode-hook 'display-line-numbers-mode)
(add-hook 'text-mode-hook 'display-line-numbers-mode)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:0debe8fd-b319-4ab7-a92c-784fa7896b75" class="outline-3">
<h3 id="h:0debe8fd-b319-4ab7-a92c-784fa7896b75"><span class="section-number-3">4.2.</span> Mark all themes as safe</h3>
<div class="outline-text-3" id="text-h:0debe8fd-b319-4ab7-a92c-784fa7896b75">
<p>
Normally when switching themes in emacs, the user will be warned that themes can run malicious code. I only run one theme really and deem it safe. It is however annoying to be asked this on every new system and it also creates lines in custom.el to answer that query, so here I declare all themes as safe.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq custom-safe-themes t)

</pre>
</div>
</div>
</div>
<div id="outline-container-h:b587e869-9911-443b-bc6d-8fb3ce31908d" class="outline-3">
<h3 id="h:b587e869-9911-443b-bc6d-8fb3ce31908d"><span class="section-number-3">4.3.</span> Show less compilation warnings</h3>
<div class="outline-text-3" id="text-h:b587e869-9911-443b-bc6d-8fb3ce31908d">
<p>
When Emacs compiles stuff, it often shows a bunch of warnings that I do not need to deal with. Here we silence those. Some will be disabled completely, and some only when we have native compilation available (which should be most of the time, however).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq byte-compile-warnings '(not free-vars unresolved noruntime lexical make-local))
;; Make native compilation silent and prune its cache.
(when (native-comp-available-p)
  (setq native-comp-async-report-warnings-errors 'silent) ; Emacs 28 with native compilation
  (setq native-compile-prune-cache t)) ; Emacs 29

</pre>
</div>
</div>
</div>

<div id="outline-container-h:6527b3ce-b76d-431a-9960-a57da7c53e1b" class="outline-3">
<h3 id="h:6527b3ce-b76d-431a-9960-a57da7c53e1b"><span class="section-number-3">4.4.</span> Indentation</h3>
<div class="outline-text-3" id="text-h:6527b3ce-b76d-431a-9960-a57da7c53e1b">
<p>
Here I define several options related to indentation; I first make it so that only whitespace will be used instead of tab characters for indentation, and I also set a small standard indent.
</p>

<p>
We set <code>tab-always-indent</code> to <code>'complete</code> in order to indent first and then do completion if there are any. Also we make it so that python will not complain about missing indentation info.
</p>

<p>
Lastly, I load the <code>highlight-indent-guides</code> package. This adds a neat visual indicator of the indentation level, which is useful for languages like python.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq-default indent-tabs-mode nil
              tab-width 2)

(setq tab-always-indent 'complete)
(setq python-indent-guess-indent-offset-verbose nil)

(use-package highlight-indent-guides
  :hook (prog-mode . highlight-indent-guides-mode)
  :init
  (setq highlight-indent-guides-method 'column)
  (setq highlight-indent-guides-responsive 'top)
  )

(with-eval-after-load 'highlight-indent-guides
  (set-face-attribute 'highlight-indent-guides-even-face nil :background "gray10")
  (set-face-attribute 'highlight-indent-guides-odd-face nil :background "gray20")
  (set-face-attribute 'highlight-indent-guides-stack-even-face nil :background "gray40")
  (set-face-attribute 'highlight-indent-guides-stack-odd-face nil :background "gray50"))
</pre>
</div>
</div>
</div>

<div id="outline-container-h:3dc9fb1d-cd16-4bd0-a9ac-55a944415a90" class="outline-3">
<h3 id="h:3dc9fb1d-cd16-4bd0-a9ac-55a944415a90"><span class="section-number-3">4.5.</span> Scrolling</h3>
<div class="outline-text-3" id="text-h:3dc9fb1d-cd16-4bd0-a9ac-55a944415a90">
<p>
By default, emacs scrolls half a page when reaching the bottom of the buffer. This is extremely annoying. This sets up more granular scrolling that allows scrolling with a mouse wheel or the two-finger touchscreen gesture. This now also works in buffers with a very small frame.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq mouse-wheel-scroll-amount
      '(1
        ((shift) . 5)
        ((meta) . 0.5)
        ((control) . text-scale))
      mouse-drag-copy-region nil
      make-pointer-invisible t
      mouse-wheel-progressive-speed t
      mouse-wheel-follow-mouse t)

(setq-default scroll-preserve-screen-position t
              scroll-conservatively 1
              scroll-margin 0
              next-screen-context-lines 0)

(pixel-scroll-precision-mode 1)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:5bf9f014-ee96-42da-b285-7b34f04e6bb1" class="outline-3">
<h3 id="h:5bf9f014-ee96-42da-b285-7b34f04e6bb1"><span class="section-number-3">4.6.</span> Evil</h3>
<div class="outline-text-3" id="text-h:5bf9f014-ee96-42da-b285-7b34f04e6bb1">
</div>

<div id="outline-container-h:218376e8-086b-46bf-91b3-78295d5d440f" class="outline-4">
<h4 id="h:218376e8-086b-46bf-91b3-78295d5d440f"><span class="section-number-4">4.6.1.</span> General evil</h4>
<div class="outline-text-4" id="text-h:218376e8-086b-46bf-91b3-78295d5d440f">
<p>
This setups up evil, which brings vim-like keybindings to emacs. In the same location, I also unbind the <code>C-z</code> key (I am very unhappy with this implementation, but it is the only thing that works consistently so far) to make it available for <a href="#h:c3cc1c12-3ab8-42b7-be07-63f54eac397f">cape</a> later.
</p>

<p>
Also, I setup initial modes for several major-modes depending on what I deem fit.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; Emulate vim in emacs
(use-package evil
  :init
  (setq evil-want-integration t) ; loads evil
  (setq evil-want-keybinding nil) ; loads "helpful bindings" for other modes
  (setq evil-want-C-u-scroll t) ; scrolling using C-u
  (setq evil-want-C-i-jump nil) ; jumping with C-i
  (setq evil-want-Y-yank-to-eol t) ; give Y some utility
  (setq evil-shift-width 2) ; uniform indent
  (setq evil-respect-visual-line-mode t) ; i am torn on this one
  (setq evil-split-window-below t)
  (setq evil-vsplit-window-right t)
  :config
  (evil-mode 1)
  (define-key evil-normal-state-map (kbd "C-z") nil)
  (define-key evil-insert-state-map (kbd "C-z") nil)
  (define-key evil-visual-state-map (kbd "C-z") nil)
  (define-key evil-motion-state-map (kbd "C-z") nil)
  (define-key evil-operator-state-map (kbd "C-z") nil)
  (define-key evil-replace-state-map (kbd "C-z") nil)
  (define-key global-map (kbd "C-z") nil)
  (evil-set-undo-system 'undo-tree)

  ;; Don't use evil-mode in these contexts, or use it in a specific mode
  (evil-set-initial-state 'messages-buffer-mode 'emacs)
  (evil-set-initial-state 'dashboard-mode 'emacs)
  (evil-set-initial-state 'dired-mode 'emacs)
  (evil-set-initial-state 'cfw:details-mode 'emacs)
  (evil-set-initial-state 'Custom-mode 'emacs) ; god knows why this mode is in uppercase
  (evil-set-initial-state 'mu4e-headers-mode 'normal)
  (evil-set-initial-state 'python-inferior-mode 'normal)
  (add-hook 'org-capture-mode-hook 'evil-insert-state)
  (add-to-list 'evil-buffer-regexps '("COMMIT_EDITMSG" . insert)))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:bde208f3-01ef-4dc6-9981-65f3d2a8189b" class="outline-4">
<h4 id="h:bde208f3-01ef-4dc6-9981-65f3d2a8189b"><span class="section-number-4">4.6.2.</span> evil-collection</h4>
<div class="outline-text-4" id="text-h:bde208f3-01ef-4dc6-9981-65f3d2a8189b">
<p>
This gives support for many different modes, and works beautifully out of the box.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package evil-collection
  :after evil
  :config
  (evil-collection-init)
  (setq forge-add-default-bindings nil))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d80e3f7d-0185-4a15-832b-d756e576265c" class="outline-4">
<h4 id="h:d80e3f7d-0185-4a15-832b-d756e576265c"><span class="section-number-4">4.6.3.</span> evil-snipe</h4>
<div class="outline-text-4" id="text-h:d80e3f7d-0185-4a15-832b-d756e576265c">
<p>
This package changes the char-search commands like <code>f</code> by showing the results in a more visual manner. It also gives a 2-character search using <code>s</code> and <code>S</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; enables 2-char inline search
  (use-package evil-snipe
    :after evil
    :demand
    :config
    (evil-snipe-mode +1)
    ;; replace 1-char searches (f&amp;t) with this better UI
    (evil-snipe-override-mode +1))
</pre>
</div>
</div>
</div>

<div id="outline-container-h:b06a378d-5248-4451-8eee-e65a3a768b1d" class="outline-4">
<h4 id="h:b06a378d-5248-4451-8eee-e65a3a768b1d"><span class="section-number-4">4.6.4.</span> evil-cleverparens</h4>
<div class="outline-text-4" id="text-h:b06a378d-5248-4451-8eee-e65a3a768b1d">
<p>
This helps keeping parentheses balanced which is useful when writing in languages like Elisp. I do not activate this by default, as most languages do not profit from this enough in my eyes.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; for parentheses-heavy languades modify evil commands to keep balance of parantheses
(use-package evil-cleverparens)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:aac82e5e-d882-4870-b644-ebdd0a2daae3" class="outline-4">
<h4 id="h:aac82e5e-d882-4870-b644-ebdd0a2daae3"><span class="section-number-4">4.6.5.</span> evil-surround</h4>
<div class="outline-text-4" id="text-h:aac82e5e-d882-4870-b644-ebdd0a2daae3">
<p>
This minor-mode adds functionality for doing better surround-commands; for example <code>ci[</code> will let you change the word within square brackets.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; enables surrounding text with S
(use-package evil-surround
  :config
  (global-evil-surround-mode 1))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-h:e888d7a7-1755-4109-af11-5358b8cf140e" class="outline-3">
<h3 id="h:e888d7a7-1755-4109-af11-5358b8cf140e"><span class="section-number-3">4.7.</span> ispell</h3>
<div class="outline-text-3" id="text-h:e888d7a7-1755-4109-af11-5358b8cf140e">
<p>
This should setup a wordlist that can be used as a dictionary. However, for some reason this does not work, and I will need to further investigate this issue.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; set the NixOS wordlist by hand
(setq ispell-alternate-dictionary "/nix/store/gjmvnbs97cnw19wnqh9m075cdbhy8r8g-wordlist-WORDLIST")

</pre>
</div>
</div>
</div>

<div id="outline-container-h:60f87342-0491-4c56-8057-6f075cf35753" class="outline-3">
<h3 id="h:60f87342-0491-4c56-8057-6f075cf35753"><span class="section-number-3">4.8.</span> Font Configuration</h3>
<div class="outline-text-3" id="text-h:60f87342-0491-4c56-8057-6f075cf35753">
<p>
Here I define my fonts to be used. Honestly I do not understand the face-attributes and pitches of emacs all too well. It seems this configuration works fine, but I might have to revisit this at some point in the future.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(dolist (face '(default fixed-pitch))
  (set-face-attribute face nil
                      :font "FiraCode Nerd Font Mono"))
(add-to-list 'default-frame-alist '(font . "FiraCode Nerd Font Mono"))

(set-face-attribute 'default nil :height 100)
(set-face-attribute 'fixed-pitch nil :height 1.0)

(set-face-attribute 'variable-pitch nil
                    :family "IBM Plex Sans"
                    :weight 'regular
                    :height 1.06)

;; these settings used to be in custom.el

</pre>
</div>
</div>
</div>

<div id="outline-container-h:72a9704b-83d2-4b74-a1f6-d333203f62db" class="outline-3">
<h3 id="h:72a9704b-83d2-4b74-a1f6-d333203f62db"><span class="section-number-3">4.9.</span> Theme</h3>
<div class="outline-text-3" id="text-h:72a9704b-83d2-4b74-a1f6-d333203f62db">
<p>
I have grown to love the <code>doom-citylights</code> theme and have modeled my whole system after it. Also solaire-mode is a nice mode that inverts the alt-faces with the normal faces for specific 'minor' buffers (like Help-buffers).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package solaire-mode
  :custom
  (solaire-global-mode +1))

(use-package doom-themes
  :hook
  (server-after-make-frame . (lambda () (load-theme
                                         'doom-city-lights t)))
  :config
  (load-theme 'doom-city-lights t)
  (doom-themes-treemacs-config)
  (doom-themes-org-config))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:eb0ea526-a83a-4664-b3a1-2b40d3a31493" class="outline-3">
<h3 id="h:eb0ea526-a83a-4664-b3a1-2b40d3a31493"><span class="section-number-3">4.10.</span> Icons</h3>
<div class="outline-text-3" id="text-h:eb0ea526-a83a-4664-b3a1-2b40d3a31493">
<p>
This section loads the base icons used in my configuration. I am using <code>nerd-icons</code> over <code>all-the-icons</code> since the former seems to have more integrations with different packages than the latter.
</p>

<p>
Used in:
</p>
<ul class="org-ul">
<li><a href="#h:b190d512-bfb5-42ec-adec-8d86bab726ce">Vertico and friends</a></li>
<li><a href="#h:5653d693-ecca-4c95-9633-66b9e3241070">IN USE Corfu</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package nerd-icons)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:455ed7ac-ee7f-4f94-b857-f2c58b2282d0" class="outline-3">
<h3 id="h:455ed7ac-ee7f-4f94-b857-f2c58b2282d0"><span class="section-number-3">4.11.</span> Variable Pitch Mode</h3>
<div class="outline-text-3" id="text-h:455ed7ac-ee7f-4f94-b857-f2c58b2282d0">
<p>
This minor mode allows mixing fixed and variable pitch fonts within the same buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package mixed-pitch
  :custom
  (mixed-pitch-set-height nil)
  (mixed-pitch-variable-pitch-cursor nil)
  :hook
  (text-mode . mixed-pitch-mode))


</pre>
</div>
</div>
</div>

<div id="outline-container-h:ed585848-875a-4673-910c-d2e1901dd95b" class="outline-3">
<h3 id="h:ed585848-875a-4673-910c-d2e1901dd95b"><span class="section-number-3">4.12.</span> Modeline</h3>
<div class="outline-text-3" id="text-h:ed585848-875a-4673-910c-d2e1901dd95b">
<p>
Here I set up the modeline with some information that I find useful. Specficially I am using the doom modeline. Most informations I disable for it, except for the cursor information (row + column) as well as a widget for <code>mu4e</code> and git information.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package doom-modeline
  :init
  (doom-modeline-mode)
  (column-number-mode)
  :custom
  ((doom-modeline-height 22)
   (doom-modeline-indent-info nil)
   (doom-modeline-buffer-encoding nil)))


</pre>
</div>
</div>
</div>

<div id="outline-container-h:39ae01e9-8053-4f76-aa77-8cbbbcff9652" class="outline-3">
<h3 id="h:39ae01e9-8053-4f76-aa77-8cbbbcff9652"><span class="section-number-3">4.13.</span> Helper Modes</h3>
<div class="outline-text-3" id="text-h:39ae01e9-8053-4f76-aa77-8cbbbcff9652">
</div>
<div id="outline-container-h:b190d512-bfb5-42ec-adec-8d86bab726ce" class="outline-4">
<h4 id="h:b190d512-bfb5-42ec-adec-8d86bab726ce"><span class="section-number-4">4.13.1.</span> Vertico, Orderless, Marginalia, Consult, Embark</h4>
<div class="outline-text-4" id="text-h:b190d512-bfb5-42ec-adec-8d86bab726ce">
<p>
This set of packages uses the default emacs completion framework and works together to provide a very nice user experience:
</p>

<ul class="org-ul">
<li>Vertico simply provides a vertically stacking completion</li>
<li>Marginalia adds more information to completion results</li>
<li>Orderless allows for fuzzy matching</li>
<li>Consult provides better implementations for several user functions, e.g. <code>consult-line</code> or <code>consult-outline</code></li>
<li>Embark allows acting on the results in the minibuffer while the completion is still ongoing - this is extremely useful since it allows to, for example, read the documentation for several functions without closing the help search. It can also collect the results of a grep operation into a seperate buffer that edits the result in their original location.</li>
</ul>

<p>
Nerd icons is originally enabled here: <a href="#h:eb0ea526-a83a-4664-b3a1-2b40d3a31493">Icons</a>
</p>
</div>

<ol class="org-ol">
<li><a id="h:d7c7f597-f870-4e01-8f7e-27dd31dd245d"></a>vertico<br />
<div class="outline-text-5" id="text-h:d7c7f597-f870-4e01-8f7e-27dd31dd245d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq read-buffer-completion-ignore-case t
      read-file-name-completion-ignore-case t
      completion-ignore-case t)

(use-package vertico
  :custom
  (vertico-scroll-margin 0)
  (vertico-count 10)
  (vertico-resize t)
  (vertico-cycle t)
  :init
  (vertico-mode)
  (vertico-mouse-mode))
</pre>
</div>
</div>
</li>

<li><a id="h:10d4f2bd-8c72-430b-a9ed-9b5e279ec0b4"></a>vertico-directory<br />
<div class="outline-text-5" id="text-h:10d4f2bd-8c72-430b-a9ed-9b5e279ec0b4">
<p>
This package allows for <code>Ido</code>-like directory navigation.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vertico-directory
  :ensure nil
  :after vertico
  :bind (:map vertico-map
              ("RET" . vertico-directory-enter)
              ("C-DEL" . vertico-directory-delete-word)
              ("DEL" . vertico-directory-delete-char))
  ;; Tidy shadowed file names
  :hook (rfn-eshadow-update-overlay . vertico-directory-tidy))

</pre>
</div>
</div>
</li>

<li><a id="h:211fc0bd-0d64-4577-97d8-6abc94435f04"></a>orderless<br />
<div class="outline-text-5" id="text-h:211fc0bd-0d64-4577-97d8-6abc94435f04">
<p>
The completion styles that I chose here can possibly still be improved. I need to spend more time on this.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package orderless
  :custom
  (completion-styles '(orderless flex basic))
  (completion-category-overrides '((file (styles . (partial-completion)))
                                   (eglot (styles orderless)))))

</pre>
</div>
</div>
</li>

<li><a id="h:49ab82bf-812d-4fbe-a5b6-d3ad703fe32c"></a>consult<br />
<div class="outline-text-5" id="text-h:49ab82bf-812d-4fbe-a5b6-d3ad703fe32c">
<p>
The big winner here are the convenient keybinds being setup here for general use. Also, I setup vim-navigation for minibuffer completions. <code>consult-buffer</code> is set twice because I am still used to that weird <code>C-M-j</code> command that I chose for <code>ivy-switch-buffer</code> when I first started using Emacs. I want to move to the other command but for now it is not feasible to delete the other one.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package consult
  :config
  (setq consult-fontify-max-size 1024)
  :bind
  (("C-x b" . consult-buffer)
   ("C-c &lt;C-m&gt;" . consult-global-mark)
   ("C-c C-a" . consult-org-agenda)
   ("C-x O" . consult-org-heading)
   ("C-M-j" . consult-buffer)
   ("C-s" . consult-line)
   ("M-g M-g" . consult-goto-line)
   ("M-g i" . consult-imenu)
   ("M-s M-s" . consult-line-multi)
   :map minibuffer-local-map
   ("C-j" . next-line)
   ("C-k" . previous-line)))

</pre>
</div>
</div>
</li>
<li><a id="h:1c564ee5-ccd7-48be-b69a-d963400c4704"></a>embark<br />
<div class="outline-text-5" id="text-h:1c564ee5-ccd7-48be-b69a-d963400c4704">
<p>
I have stripped down the embark keybinds heavily. It is very useful to me even in it's current state, but it quickly becomes overwhelming. <code>embark-dwim</code> acts on a candidate without closing the minibuffer, which is very useful. <code>embark-act</code> lets the user choose from all actions, but has an overwhelming interface.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package embark
  :bind
  (("C-." . embark-act)
   ("M-." . embark-dwim)
   ("C-h B" . embark-bindings)
   ("C-c c" . embark-collect))
  :custom
  (prefix-help-command #'embark-prefix-help-command)
  (embark-quit-after-action '((t . nil)))
  :config
  (add-to-list 'display-buffer-alist
               '("\\`\\*Embark Collect \\(Live\\|Completions\\)\\*"
                 nil
                 (window-parameters (mode-line-format . none)))))

</pre>
</div>
</div>
</li>
<li><a id="h:6287551c-a6f7-4870-b3f3-210d6f038b6f"></a>embark-consult<br />
<div class="outline-text-5" id="text-h:6287551c-a6f7-4870-b3f3-210d6f038b6f">
<p>
Provides previews for embark.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package embark-consult
  :after (embark consult)
  :demand t ; only necessary if you have the hook below
  ;; if you want to have consult previews as you move around an
  ;; auto-updating embark collect buffer
  :hook
  (embark-collect-mode . consult-preview-at-point-mode))
</pre>
</div>
</div>
</li>
<li><a id="h:f32040a4-882f-4e6b-97f1-a0105c44c034"></a>marginalia<br />
<div class="outline-text-5" id="text-h:f32040a4-882f-4e6b-97f1-a0105c44c034">
<p>
I set the annotation-mode of marginalia to <code>heavy</code>. This gives even more information on the stuff that you are looking at. One thing I am missing from ivy is the highlighting on <code>mode</code>-commands based on the current state of the mode. Also, I do not understand all the shorthands used by marginalia yet.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package marginalia
  :after vertico
  :init
  (marginalia-mode)
  (setq marginalia-annotators '(marginalia-annotators-heavy marginalia-annotators-light nil)))

</pre>
</div>
</div>
</li>
<li><a id="h:d70ec2fb-da43-4523-9ee4-774ececdb80e"></a>nerd-icons-completion<br />
<div class="outline-text-5" id="text-h:d70ec2fb-da43-4523-9ee4-774ececdb80e">
<p>
As stated above, this simply provides nerd-icons to the completion framework.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package nerd-icons-completion
  :after (marginalia nerd-icons)
  :hook (marginalia-mode . nerd-icons-completion-marginalia-setup)
  :init
  (nerd-icons-completion-mode))


</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-h:cbf6bd48-2503-489a-89da-e3359564e989" class="outline-4">
<h4 id="h:cbf6bd48-2503-489a-89da-e3359564e989"><span class="section-number-4">4.13.2.</span> Helpful + which-key: Better help defaults</h4>
<div class="outline-text-4" id="text-h:cbf6bd48-2503-489a-89da-e3359564e989">
<p>
This pair of packages provides information on keybinds in addition to function names, which makes it easier to remember keybinds (<code>which-key</code>). The <code>helpful</code> package provides a better <code>Help</code> framework for Emacs. For some reason, the Help windows are always being focused by the cursor even though I have set <code>help-window-select</code> to nil. I do not understand why.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package which-key
  :init (which-key-mode)
  :diminish which-key-mode
  :config
  (setq which-key-idle-delay 0.3))

(use-package helpful
  :bind
  (("C-h f" . helpful-callable)
   ("C-h v" . helpful-variable)
   ("C-h k" . helpful-key)
   ("C-h C-." . helpful-at-point))
  :config
  (setq help-window-select nil))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-h:bbbd9cc8-3a84-4810-a3d5-b8536a5fbda1" class="outline-3">
<h3 id="h:bbbd9cc8-3a84-4810-a3d5-b8536a5fbda1"><span class="section-number-3">4.14.</span> Ligatures</h3>
<div class="outline-text-3" id="text-h:bbbd9cc8-3a84-4810-a3d5-b8536a5fbda1">
<p>
Personally, I think ligatures are fancy. With this mode, they stay 'cursorable'. However, I do not need them in all modes, so I only use them in programming modes.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package ligature
  :init
  (global-ligature-mode t)
  :config
  (ligature-set-ligatures 'prog-mode
                          '("|||&gt;" "&lt;|||" "&lt;==&gt;" "&lt;!--" "####" "~~&gt;" "***" "||=" "||&gt;"
                            ":::" "::=" "=:=" "===" "==&gt;" "=!=" "=&gt;&gt;" "=&lt;&lt;" "=/=" "!=="
                            "!!." "&gt;=&gt;" "&gt;&gt;=" "&gt;&gt;&gt;" "&gt;&gt;-" "&gt;-&gt;" "-&gt;&gt;" "--&gt;" "---" "-&lt;&lt;"
                            "&lt;~~" "&lt;~&gt;" "&lt;*&gt;" "&lt;||" "&lt;|&gt;" "&lt;$&gt;" "&lt;==" "&lt;=&gt;" "&lt;=&lt;" "&lt;-&gt;"
                            "&lt;--" "&lt;-&lt;" "&lt;&lt;=" "&lt;&lt;-" "&lt;&lt;&lt;" "&lt;+&gt;" "&lt;/&gt;" "###" "#_(" "..&lt;"
                            "..." "+++" "/==" "///" "_|_" "www" "&amp;&amp;" "^=" "~~" "~@" "~="
                            "~&gt;" "~-" "**" "*&gt;" "*/" "||" "|}" "|]" "|=" "|&gt;" "|-" "{|"
                            "[|" "]#" "::" ":=" ":&gt;" ":&lt;" "$&gt;" "==" "=&gt;" "!=" "!!" "&gt;:"
                            "&gt;=" "&gt;&gt;" "&gt;-" "-~" "-|" "-&gt;" "--" "-&lt;" "&lt;~" "&lt;*" "&lt;|" "&lt;:"
                            "&lt;$" "&lt;=" "&lt;&gt;" "&lt;-" "&lt;&lt;" "&lt;+" "&lt;/" "#{" "#[" "#:" "#=" "#!"
                            "##" "#(" "#?" "#_" "%%" ".=" ".." ".?" "+&gt;" "++" "?:" "?="
                            "?." "??" "/*" "/=" "/&gt;" "//" "__" "~~" "(*" "*)" "\\\\"
                            "://" ";;")))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:e9d40e63-0e1f-47df-98f7-5427992588a4" class="outline-3">
<h3 id="h:e9d40e63-0e1f-47df-98f7-5427992588a4"><span class="section-number-3">4.15.</span> Popup (popper) + Shackle Buffers</h3>
<div class="outline-text-3" id="text-h:e9d40e63-0e1f-47df-98f7-5427992588a4">
<p>
The popper package allows to declare different buffers as 'popup-type', which sort of acts like a scratchpad. It can be toggled at any time using <code>popper-toggle</code> and the resulting frame can be freely customized (with <code>shackle</code>) to a certain size. It is also possible to prevent a buffer from appearing - I do this for example to the <code>*Warnings*</code> buffer, since usually I am not interested in it's output.
</p>

<p>
<code>popper-echo-mode</code> shows all buffers that are currently stored as a popup in the echo area when a popup is opened - this is useful since you can cycle between all popup buffers.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package popper
  :bind (("M-["   . popper-toggle))
  :init
  (setq popper-reference-buffers
        '("\\*Messages\\*"
          ("\\*Warnings\\*" . hide)
          "Output\\*$"
          "\\*Async Shell Command\\*"
          "\\*Async-native-compile-log\\*"
          help-mode
          helpful-mode
          "*Occur*"
          "*scratch*"
          "*julia*"
          "*Python*"
          ;; ("*tex-shell*" . hide)
          (compilation-mode . hide)))
  (popper-mode +1)
  (popper-echo-mode +1))

(use-package shackle
  :config
  (setq shackle-rules '(("*Messages*" :select t :popup t :align right :size 0.3)
                        ("*Warnings*" :ignore t :popup t :align right :size 0.3)
                        ("*Occur*" :select t :popup t :align below :size 0.2)
                        ("*scratch*" :select t :popup t :align below :size 0.2)
                        ("*Python*" :select t :popup t :align below :size 0.2)
                        ("*tex-shell*" :ignore t :popup t :align below :size 0.2)
                        (helpful-mode :select t :popup t :align right :size 0.35)
                        (help-mode :select t :popup t :align right :size 0.4)))
  (shackle-mode 1))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:a6d23c8c-125f-4e36-af30-ff0a1e0d5a28" class="outline-3">
<h3 id="h:a6d23c8c-125f-4e36-af30-ff0a1e0d5a28"><span class="section-number-3">4.16.</span> Indicate first and last line of buffer</h3>
<div class="outline-text-3" id="text-h:a6d23c8c-125f-4e36-af30-ff0a1e0d5a28">
<p>
This places little angled indicators on the fringe of a window which indicate buffer boundaries. This is not super useful, but makes use of a space that I want to keep for aesthetic reasons anyways and makes it a bit more useful in the process.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq-default indicate-buffer-boundaries t)

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-h:f2622fd3-7f14-47a8-8c21-33574fcbf14b" class="outline-2">
<h2 id="h:f2622fd3-7f14-47a8-8c21-33574fcbf14b"><span class="section-number-2">5.</span> Modules</h2>
<div class="outline-text-2" id="text-h:f2622fd3-7f14-47a8-8c21-33574fcbf14b">
<p>
This section houses all configuration bits that are related to a specific package that is not fundamental to my Emacs experience.
</p>

<p>
At some point this will receive further sorting, but for now this is good enough.
</p>
</div>

<div id="outline-container-h:99544398-72af-4382-b8e1-01b2221baff4" class="outline-3">
<h3 id="h:99544398-72af-4382-b8e1-01b2221baff4"><span class="section-number-3">5.1.</span> Org Mode</h3>
<div class="outline-text-3" id="text-h:99544398-72af-4382-b8e1-01b2221baff4">
<p>
org-mode is probably my most-used mode in Emcas. It acts as my organizer, config management tool and calender even.
</p>

<p>
Note that nearly all headings within the <code>Org-mode</code> heading are coded within the <code>use-package</code> setup, so be very careful about moving stuff about here.
</p>
</div>

<div id="outline-container-h:877c9401-a354-4e44-a235-db1a90d19e00" class="outline-4">
<h4 id="h:877c9401-a354-4e44-a235-db1a90d19e00"><span class="section-number-4">5.1.1.</span> General org-mode</h4>
<div class="outline-text-4" id="text-h:877c9401-a354-4e44-a235-db1a90d19e00">
<p>
This sets up the basic org-mode. I wrote a function to handle some of the initial org-mode behaviour in <a href="#h:06b77d28-3fd5-4554-8c7d-32c1b0ec8da5">org-mode setup.
</a>
This part of the configuration mostly makes some aesthetic changes, enables neat LaTeX and points Emacs to some files that it needs for org-mode
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package org
  ;;:diminish (org-indent-mode)
  :hook (org-mode . swarsel/org-mode-setup)
  :bind
  (("C-&lt;tab&gt;" . org-fold-outer)
  ("C-c s" . org-store-link))
  :config
  (setq org-ellipsis " ⤵"
        org-link-descriptive t
        org-hide-emphasis-markers t)
  (setq org-startup-folded t)
  (setq org-support-shift-select t)

  ;; (setq org-agenda-start-with-log-mode t)
  ;; (setq org-log-done 'time)
  ;; (setq org-log-into-drawer t)
  (setq org-startup-with-inline-images t)
  (setq org-image-actual-width nil)
  (setq org-format-latex-options '(:foreground "White" :background default :scale 2.0 :html-foreground "Black" :html-background "Transparent" :html-scale 1.0 :matchers ("begin" "$1" "$" "$$" "\\(" "\\[")))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:2b3b4eb6-68a1-476d-b5d1-940a21484f1d" class="outline-4">
<h4 id="h:2b3b4eb6-68a1-476d-b5d1-940a21484f1d"><span class="section-number-4">5.1.2.</span> org-agenda</h4>
<div class="outline-text-4" id="text-h:2b3b4eb6-68a1-476d-b5d1-940a21484f1d">
<p>
Here I setup a plethora of keywords, keybinds and paths to give my org-agenda more power.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq org-agenda-files '("/home/swarsel/Nextcloud/Org/Tasks.org"
                         "/home/swarsel/Nextcloud/Org/Archive.org"
                         "/home/swarsel/Nextcloud/Org/Anki.org"
                         "/home/swarsel/Calendars/leon_cal.org"))

(setq org-refile-targets
      '((swarsel-archive-org-file :maxlevel . 1)
        (swarsel-anki-org-file :maxlevel . 1)
        (swarsel-tasks-org-file :maxlevel . 1)))

(setq org-todo-keywords
      '((sequence "TODO(t)" "NEXT(n)" "|" "DONE(d!)")
        (sequence "BACKLOG(b)" "PLAN(p)" "READY(r)" "ACTIVE(a)" "REVIEW(v)" "WAIT(w@/!)" "HOLD(h)" "|" "COMPLETED(c)" "CANC(k@)")))


;; Configure custom agenda views
(setq org-agenda-custom-commands
      '(("d" "Dashboard"
         ((agenda "" ((org-deadline-warning-days 7)))
          (todo "NEXT"
                ((org-agenda-overriding-header "Next Tasks")))
          (tags-todo "agenda/ACTIVE" ((org-agenda-overriding-header "Active Projects")))))

        ("n" "Next Tasks"
         ((todo "NEXT"
                ((org-agenda-overriding-header "Next Tasks")))))

        ("W" "Work Tasks" tags-todo "+work-email")


        ("w" "Workflow Status"
         ((todo "WAIT"
                ((org-agenda-overriding-header "Waiting on External")
                 (org-agenda-files org-agenda-files)))
          (todo "REVIEW"
                ((org-agenda-overriding-header "In Review")
                 (org-agenda-files org-agenda-files)))
          (todo "PLAN"
                ((org-agenda-overriding-header "In Planning")
                 (org-agenda-todo-list-sublevels nil)
                 (org-agenda-files org-agenda-files)))
          (todo "BACKLOG"
                ((org-agenda-overriding-header "Project Backlog")
                 (org-agenda-todo-list-sublevels nil)
                 (org-agenda-files org-agenda-files)))
          (todo "READY"
                ((org-agenda-overriding-header "Ready for Work")
                 (org-agenda-files org-agenda-files)))
          (todo "ACTIVE"
                ((org-agenda-overriding-header "Active Projects")
                 (org-agenda-files org-agenda-files)))
          (todo "COMPLETED"
                ((org-agenda-overriding-header "Completed Projects")
                 (org-agenda-files org-agenda-files)))
          (todo "CANC"
                ((org-agenda-overriding-header "Cancelled Projects")
                 (org-agenda-files org-agenda-files)))))))


</pre>
</div>
</div>
</div>
<div id="outline-container-h:23183635-3d46-4d7d-8eda-e0a085b335ef" class="outline-4">
<h4 id="h:23183635-3d46-4d7d-8eda-e0a085b335ef"><span class="section-number-4">5.1.3.</span> org capture templates</h4>
<div class="outline-text-4" id="text-h:23183635-3d46-4d7d-8eda-e0a085b335ef">
<p>
I wrote these capture templates to allow myself to quickly create Anki cards from within Emacs. I nearly never use this feature, but it cannot hurt to have.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq org-capture-templates
      `(
        ("a" "Anki basic"
         entry
         (file+headline swarsel-org-anki-filepath "Dispatch")
         (function swarsel-anki-make-template-string))

        ("A" "Anki cloze"
         entry
         (file+headline org-swarsel-anki-file "Dispatch")
         "* %&lt;%H:%M&gt;\n:PROPERTIES:\n:ANKI_NOTE_TYPE: Cloze\n:ANKI_DECK: 🦁 All::01 ❤️ Various::00 ✨ Allgemein\n:END:\n** Text\n%?\n** Extra\n")
        ("t" "Tasks / Projects")
        ("tt" "Task" entry (file+olp swarsel-org-tasks-filepath "Inbox")
         "* TODO %?\n  %U\n  %a\n  %i" :empty-lines 1)
        ))
)
</pre>
</div>
</div>
</div>

<div id="outline-container-h:40528f5a-c8cd-471b-b862-4088e8e61860" class="outline-4">
<h4 id="h:40528f5a-c8cd-471b-b862-4088e8e61860"><span class="section-number-4">5.1.4.</span> Font Faces</h4>
<div class="outline-text-4" id="text-h:40528f5a-c8cd-471b-b862-4088e8e61860">
<p>
Again, my understanding of the font-faces in Emacs is limited. This is mostly just tuned so that my org-files look acceptable.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">


;; Set faces for heading levels
(with-eval-after-load 'org-faces  (dolist (face '((org-level-1 . 1.1)
                                                  (org-level-2 . 0.9)
                                                  (org-level-3 . 0.9)
                                                  (org-level-4 . 0.9)
                                                  (org-level-5 . 0.9)
                                                  (org-level-6 . 0.9)
                                                  (org-level-7 . 0.9)
                                                  (org-level-8 . 0.9)))
                                    (set-face-attribute (car face) nil :font swarsel-alt-font :weight 'medium :height (cdr face)))

                      ;; Ensure that anything that should be fixed-pitch in Org files appears that way
                      (set-face-attribute 'org-block nil   :inherit 'fixed-pitch)
                      (set-face-attribute 'org-table nil   :inherit 'fixed-pitch)
                      (set-face-attribute 'org-formula nil   :inherit 'fixed-pitch)
                      (set-face-attribute 'org-code nil :inherit '(shadow fixed-pitch))
                      (set-face-attribute 'org-verbatim nil :inherit '(shadow fixed-pitch))
                      (set-face-attribute 'org-special-keyword nil :inherit '(font-lock-comment-face fixed-pitch))
                      (set-face-attribute 'org-meta-line nil :inherit '(font-lock-comment-face fixed-pitch))
                      (set-face-attribute 'org-checkbox nil :inherit 'fixed-pitch))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:62829574-a069-44b8-afb3-401a268d2747" class="outline-4">
<h4 id="h:62829574-a069-44b8-afb3-401a268d2747"><span class="section-number-4">5.1.5.</span> org-appear</h4>
<div class="outline-text-4" id="text-h:62829574-a069-44b8-afb3-401a268d2747">
<p>
This package makes emphasis-markers appear when the cursor moves over them. Very useful as I enjoy the clean look of not always seeing them, but it is annoying not to be able to edit them properly.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package org-appear
  :hook (org-mode . org-appear-mode)
  :init
  (setq org-appear-autolinks t)
  (setq org-appear-autokeywords t)
  (setq org-appear-autoentities t)
  (setq org-appear-autosubmarkers t))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:bbcfa895-4d46-4b1d-b84e-f634e982c46e" class="outline-4">
<h4 id="h:bbcfa895-4d46-4b1d-b84e-f634e982c46e"><span class="section-number-4">5.1.6.</span> Centered org-mode Buffers</h4>
<div class="outline-text-4" id="text-h:bbcfa895-4d46-4b1d-b84e-f634e982c46e">
<p>
I like org-mode buffers to be centered, as I do not find that enormous lines are of big use.
</p>

<p>
Function definition in: <a href="#h:fa710375-2efe-49b4-af6a-a875aca6e4a2">Visual-fill column</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package visual-fill-column
  :hook (org-mode . swarsel/org-mode-visual-fill))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:c1a0adea-ca97-43d7-b5a0-b856d2ebc9a8" class="outline-4">
<h4 id="h:c1a0adea-ca97-43d7-b5a0-b856d2ebc9a8"><span class="section-number-4">5.1.7.</span> Fix headings not folding sometimes</h4>
<div class="outline-text-4" id="text-h:c1a0adea-ca97-43d7-b5a0-b856d2ebc9a8">
<p>
There is a weird bug in org-mode that makes it so that headings were not folding correctly sometimes. This setting seems to fix it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq org-fold-core-style 'overlays)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:3e0b6da3-0497-4080-bb49-bab949c03bc4" class="outline-4">
<h4 id="h:3e0b6da3-0497-4080-bb49-bab949c03bc4"><span class="section-number-4">5.1.8.</span> Babel</h4>
<div class="outline-text-4" id="text-h:3e0b6da3-0497-4080-bb49-bab949c03bc4">
<p>
org-babel allows to run blocks in other programming languages within an org-mode buffer, similar to what e.g. jupyterhub offers for python.
</p>

<p>
It also offers a very useful utility of exporting org-mode buffers to different formats; the feature I enjoy most is what makes this file useful: the tangling functionality.
</p>
</div>

<ol class="org-ol">
<li><a id="h:5d5ed7be-ec5f-4e17-bbb8-820ab6a9961c"></a>Language Configuration<br />
<div class="outline-text-5" id="text-h:5d5ed7be-ec5f-4e17-bbb8-820ab6a9961c">
<ul class="org-ul">
<li>This configures the languages that babel recognizes.</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(org-babel-do-load-languages
 'org-babel-load-languages
 '((emacs-lisp . t)
   (python . t)
   (shell . t)
   ))

(push '("conf-unix" . conf-unix) org-src-lang-modes)

</pre>
</div>
</div>
</li>

<li><a id="h:d112ed66-b2dd-45cc-8d70-9cf6631f28a9"></a>old easy structure templates<br />
<div class="outline-text-5" id="text-h:d112ed66-b2dd-45cc-8d70-9cf6631f28a9">
<ul class="org-ul">
<li><p>
org 9.2 changed the way structure templates work. This brings back the old way it worked.
</p>

<p>
Usage: Type <code>&lt;</code>, followed by one of the below keywords and press <code>RET</code>. The corresponding source block should appear.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(require 'org-tempo)
(add-to-list 'org-structure-template-alist '("sh" . "src shell"))
(add-to-list 'org-structure-template-alist '("el" . "src emacs-lisp"))
(add-to-list 'org-structure-template-alist '("py" . "src python :results output"))
(add-to-list 'org-structure-template-alist '("nix" . "src nix :tangle"))

</pre>
</div></li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-h:4696e2fc-3296-47dc-8fc3-66912c329d4c" class="outline-4">
<h4 id="h:4696e2fc-3296-47dc-8fc3-66912c329d4c"><span class="section-number-4">5.1.9.</span> aucTex</h4>
<div class="outline-text-4" id="text-h:4696e2fc-3296-47dc-8fc3-66912c329d4c">
<p>
This provides several utilities for LaTeX in Emacs, including many completions and convenience functions for math-mode.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package auctex)
(setq TeX-auto-save t)
(setq TeX-save-query nil)
(setq TeX-parse-self t)
  (setq-default TeX-master nil)

(add-hook 'LaTeX-mode-hook 'visual-line-mode)
(add-hook 'LaTeX-mode-hook 'flyspell-mode)
(add-hook 'LaTeX-mode-hook 'LaTeX-math-mode)
(add-hook 'LaTeX-mode-hook 'reftex-mode)
(setq LaTeX-electric-left-right-brace t)
(setq font-latex-fontify-script nil)
(setq TeX-electric-sub-and-superscript t)
  ;; (setq reftex-plug-into-AUCTeX t)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:406e5ecb-66f0-49bf-85ca-8b499f73ec5b" class="outline-4">
<h4 id="h:406e5ecb-66f0-49bf-85ca-8b499f73ec5b"><span class="section-number-4">5.1.10.</span> org-download</h4>
<div class="outline-text-4" id="text-h:406e5ecb-66f0-49bf-85ca-8b499f73ec5b">
<p>
This package allows to download and copy images into org-mode buffers. Sadly it does not work in a very stable manner - if you copy images that are also links to another page (like is often the case in a Google image search), Emacs might crash from this.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package org-download
  :after org
  :defer nil
  :custom
  (org-download-method 'directory)
  (org-download-image-dir "./images")
  (org-download-heading-lvl 0)
  (org-download-timestamp "org_%Y%m%d-%H%M%S_")
  ;;(org-image-actual-width 500)
  (org-download-screenshot-method "grim -g \"$(slurp)\" %s")
  :bind
  ("C-M-y" . org-download-screenshot)
  :config
  (require 'org-download))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:a02b1162-3e19-46f1-8efc-9f375971645c" class="outline-4">
<h4 id="h:a02b1162-3e19-46f1-8efc-9f375971645c"><span class="section-number-4">5.1.11.</span> org-fragtog</h4>
<div class="outline-text-4" id="text-h:a02b1162-3e19-46f1-8efc-9f375971645c">
<p>
This package automatically toggles LaTeX-fragments in org-files. It seems to also work in markdown-files which is a nice addition, as my Obsidian notes are held in markdown.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package org-fragtog)
(add-hook 'org-mode-hook 'org-fragtog-mode)
(add-hook 'markdown-mode-hook 'org-fragtog-mode)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:95b42e77-767c-4461-9ba8-b1c1cd18266c" class="outline-4">
<h4 id="h:95b42e77-767c-4461-9ba8-b1c1cd18266c"><span class="section-number-4">5.1.12.</span> org-modern</h4>
<div class="outline-text-4" id="text-h:95b42e77-767c-4461-9ba8-b1c1cd18266c">
<p>
This just makes org-mode a little bit more beautiful, mostly by making the <code>begin_src</code> and <code>end_src</code> tags in source-blocks turn into more beautiful icons, as well as hiding <code>#+</code> tags before them, as well as in the properties section of the file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package org-modern
  :config (setq org-modern-block-name
                '((t . t)
                  ("src" "»" "∥")))
  :hook (org-mode . org-modern-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:4e11a845-a7bb-4eb5-b4ce-5b2f52e07425" class="outline-4">
<h4 id="h:4e11a845-a7bb-4eb5-b4ce-5b2f52e07425"><span class="section-number-4">5.1.13.</span> Presentations</h4>
<div class="outline-text-4" id="text-h:4e11a845-a7bb-4eb5-b4ce-5b2f52e07425">
<p>
Recently I have grown fond of holding presentations using Emacs :)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
    (use-package org-present
    :bind (:map org-present-mode-keymap
           ("q" . org-present-quit)
           ("&lt;left&gt;" . swarsel/org-present-prev)
           ("&lt;up&gt;" . 'ignore)
           ("&lt;down&gt;" . 'ignore)
           ("&lt;right&gt;" . swarsel/org-present-next))
    :hook ((org-present-mode . swarsel/org-present-start)
           (org-present-mode-quit . swarsel/org-present-end))
    )


    (use-package hide-mode-line)

    (defun swarsel/org-present-start ()
      (setq-local face-remapping-alist '((default (:height 1.5) variable-pitch)
                                         (header-line (:height 4.0) variable-pitch)
                                         (org-document-title (:height 1.75) org-document-title)
                                         (org-code (:height 1.55) org-code)
                                         (org-verbatim (:height 1.55) org-verbatim)
                                         (org-block (:height 1.25) org-block)
                                         (org-block-begin-line (:height 0.7) org-block)
                                         ))
      (dolist (face '((org-level-1 . 1.1)
                                                    (org-level-2 . 1.2)
                                                    (org-level-3 . 1.2)
                                                    (org-level-4 . 1.2)
                                                    (org-level-5 . 1.2)
                                                    (org-level-6 . 1.2)
                                                    (org-level-7 . 1.2)
                                                    (org-level-8 . 1.2)))
                                      (set-face-attribute (car face) nil :font swarsel-alt-font :weight 'medium :height (cdr face)))

      (setq header-line-format " ")
      (setq visual-fill-column-width 90)
      (setq indicate-buffer-boundaries nil)
      (setq inhibit-message nil)
      (breadcrumb-mode 0)
      (org-display-inline-images)
      (global-hl-line-mode 0)
      (display-line-numbers-mode 0)
      (org-modern-mode 0)
      (evil-insert-state 1)
      (beginning-of-buffer)
      (org-present-read-only)
      ;; (org-present-hide-cursor)
      (swarsel/org-present-slide)
      )

    (defun swarsel/org-present-end ()
           (setq-local face-remapping-alist '((default variable-pitch default)))
           (dolist (face '((org-level-1 . 1.1)
                                                    (org-level-2 . 0.9)
                                                    (org-level-3 . 0.9)
                                                    (org-level-4 . 0.9)
                                                    (org-level-5 . 0.9)
                                                    (org-level-6 . 0.9)
                                                    (org-level-7 . 0.9)
                                                    (org-level-8 . 0.9)))
                                      (set-face-attribute (car face) nil :font swarsel-alt-font :weight 'medium :height (cdr face)))
           (setq header-line-format nil)
           (setq visual-fill-column-width 150)
           (setq indicate-buffer-boundaries t)
           (setq inhibit-message nil)
           (breadcrumb-mode 1)
           (global-hl-line-mode 1)
           (display-line-numbers-mode 1)
           (org-remove-inline-images)
           (org-modern-mode 1)
           (evil-normal-state 1)
           ;; (org-present-show-cursor)
           )

  (defun swarsel/org-present-slide ()
    (org-overview)
    (org-show-entry)
    (org-show-children)
      )

  (defun swarsel/org-present-prev ()
    (interactive)
    (org-present-prev)
    (swarsel/org-present-slide))

  (defun swarsel/org-present-next ()
    (interactive)
    (unless (eobp)
    (org-next-visible-heading 1)
    (org-fold-show-entry))
    (when (eobp)
    (org-present-next)
    (swarsel/org-present-slide)
    ))

(defun clojure-leave-clojure-mode-function ()
 )

(add-hook 'buffer-list-update-hook #'clojure-leave-clojure-mode-function)
    (add-hook 'org-present-mode-hook 'swarsel/org-present-start)
    (add-hook 'org-present-mode-quit-hook 'swarsel/org-present-end)
    (add-hook 'org-present-after-navigate-functions 'swarsel/org-present-slide)

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:406c2ecc-0e3e-4d9f-9ae3-3eb1f8b87d1b" class="outline-3">
<h3 id="h:406c2ecc-0e3e-4d9f-9ae3-3eb1f8b87d1b"><span class="section-number-3">5.2.</span> Nix Mode</h3>
<div class="outline-text-3" id="text-h:406c2ecc-0e3e-4d9f-9ae3-3eb1f8b87d1b">
<p>
This adds a rudimentary nix-mode to Emacs. I have not really tried this out, as I am mostly editing nix-files in org-mode anyways.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package nix-mode
  :mode "\\.nix\\'")

</pre>
</div>
</div>
</div>

<div id="outline-container-h:50327461-a11b-4e81-830a-90febc720cfa" class="outline-3">
<h3 id="h:50327461-a11b-4e81-830a-90febc720cfa"><span class="section-number-3">5.3.</span> Markdown Mode</h3>
<div class="outline-text-3" id="text-h:50327461-a11b-4e81-830a-90febc720cfa">
</div>
<div id="outline-container-h:734dc40a-a2c4-4839-b884-cb99b81aa6fe" class="outline-4">
<h4 id="h:734dc40a-a2c4-4839-b884-cb99b81aa6fe"><span class="section-number-4">5.3.1.</span> Mode</h4>
<div class="outline-text-4" id="text-h:734dc40a-a2c4-4839-b884-cb99b81aa6fe">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq markdown-command "pandoc")

(use-package markdown-mode
  :ensure t
  :mode ("README\\.md\\'" . gfm-mode)
  :init (setq markdown-command "multimarkdown")
  :bind (:map markdown-mode-map
              ("C-c C-e" . markdown-do)))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:8d90fe51-0b32-423a-a159-4f853bc29b68" class="outline-4">
<h4 id="h:8d90fe51-0b32-423a-a159-4f853bc29b68"><span class="section-number-4">5.3.2.</span> LaTeX in Markdown</h4>
<div class="outline-text-4" id="text-h:8d90fe51-0b32-423a-a159-4f853bc29b68">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(add-hook 'markdown-mode-hook
          (lambda ()
            (local-set-key (kbd "C-c C-x C-l") 'org-latex-preview)
            (local-set-key (kbd "C-c C-x C-u") 'markdown-toggle-url-hiding)
            ))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-h:65e69741-9860-4ed0-bbed-7b7be9a2a9d6" class="outline-3">
<h3 id="h:65e69741-9860-4ed0-bbed-7b7be9a2a9d6"><span class="section-number-3">5.4.</span> Olivetti</h3>
<div class="outline-text-3" id="text-h:65e69741-9860-4ed0-bbed-7b7be9a2a9d6">
<p>
Olivetti is a mode specialized for writing prose in Emacs. I went for a very simple setup with little distractions.
</p>

<p>
This mode is not automatically activated anywhere because I only rarely need it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package olivetti
  :init
  (setq olivetti-body-width 100)
  (setq olivetti-recall-visual-line-mode-entry-state t))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:94d4a0dc-b0d7-4702-b760-beeaa6da2b8f" class="outline-3">
<h3 id="h:94d4a0dc-b0d7-4702-b760-beeaa6da2b8f"><span class="section-number-3">5.5.</span> darkroom</h3>
<div class="outline-text-3" id="text-h:94d4a0dc-b0d7-4702-b760-beeaa6da2b8f">
<p>
Darkroom is package that reduces all forms of distraction to a minimum - this can be useful when simply reading a file for example. For this mode I have increased the text scale by a large margin to make for comfortable reading
This mode is not automatically activated anywhere because I only rarely need it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package darkroom
  :init
  (setq darkroom-text-scale-increase 3))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:87453f1c-8ea5-4d0a-862d-8973d5bc5405" class="outline-3">
<h3 id="h:87453f1c-8ea5-4d0a-862d-8973d5bc5405"><span class="section-number-3">5.6.</span> Ripgrep</h3>
<div class="outline-text-3" id="text-h:87453f1c-8ea5-4d0a-862d-8973d5bc5405">
<p>
This is the ripgrep command for Emacs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package rg)

</pre>
</div>
</div>
</div>
<div id="outline-container-h:543641d0-02a9-459e-a2d6-96c8fcc06864" class="outline-3">
<h3 id="h:543641d0-02a9-459e-a2d6-96c8fcc06864"><span class="section-number-3">5.7.</span> Tree-sitter</h3>
<div class="outline-text-3" id="text-h:543641d0-02a9-459e-a2d6-96c8fcc06864">
<p>
Tree-sitter is a parsing library integrated into Emacs to provide better syntax highlighting and code analysis. It generates concrete syntax trees for source code, enabling more accurate and efficient text processing. Emacs' tree-sitter integration enhances language support, offering features like incremental parsing and precise syntax-aware editing. This improves the development experience by providing robust and dynamic syntax features, making it easier for me to navigate and manipulate code.
</p>

<p>
In order to update the language grammars, run the next command below.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(mapc #'treesit-install-language-grammar (mapcar #'car treesit-language-source-alist))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package emacs
  :ensure nil
  :init
  (setq treesit-language-source-alist
        '((bash . ("https://github.com/tree-sitter/tree-sitter-bash"))
          (c . ("https://github.com/tree-sitter/tree-sitter-c"))
          (cmake . ("https://github.com/uyha/tree-sitter-cmake"))
          (cpp . ("https://github.com/tree-sitter/tree-sitter-cpp"))
          (css . ("https://github.com/tree-sitter/tree-sitter-css"))
          (elisp . ("https://github.com/Wilfred/tree-sitter-elisp"))
          (go . ("https://github.com/tree-sitter/tree-sitter-go"))
          (html . ("https://github.com/tree-sitter/tree-sitter-html"))
          (javascript . ("https://github.com/tree-sitter/tree-sitter-javascript"))
          (json . ("https://github.com/tree-sitter/tree-sitter-json"))
          (julia . ("https://github.com/tree-sitter/tree-sitter-julia"))
          (latex . ("https://github.com/latex-lsp/tree-sitter-latex"))
          (make . ("https://github.com/alemuller/tree-sitter-make"))
          (markdown . ("https://github.com/ikatyang/tree-sitter-markdown"))
          (R . ("https://github.com/r-lib/tree-sitter-r"))
          (python . ("https://github.com/tree-sitter/tree-sitter-python"))
          (typescript . ("https://github.com/tree-sitter/tree-sitter-typescript" "typescript/src" "typescript"))
          (rust . ("https://github.com/tree-sitter/tree-sitter-rust"))
          (sql . ("https://github.com/m-novikov/tree-sitter-sql"))
          (toml . ("https://github.com/tree-sitter/tree-sitter-toml"))
          (tsx  . ("https://github.com/tree-sitter/tree-sitter-typescript" "master" "typescript/src"))
          (yaml . ("https://github.com/ikatyang/tree-sitter-yaml"))))
  )

(use-package treesit-auto
  :config
  (global-treesit-auto-mode)
  (setq treesit-auto-install 'prompt))


</pre>
</div>
</div>
</div>

<div id="outline-container-h:82ddeef2-99f8-465b-ba36-07c3eaad717b" class="outline-3">
<h3 id="h:82ddeef2-99f8-465b-ba36-07c3eaad717b"><span class="section-number-3">5.8.</span> direnv</h3>
<div class="outline-text-3" id="text-h:82ddeef2-99f8-465b-ba36-07c3eaad717b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package direnv
  :custom (direnv-always-show-summary nil)
  :config (direnv-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:efb3f0fd-e846-4df9-ba48-2e45d776f68f" class="outline-3">
<h3 id="h:efb3f0fd-e846-4df9-ba48-2e45d776f68f"><span class="section-number-3">5.9.</span> avy</h3>
<div class="outline-text-3" id="text-h:efb3f0fd-e846-4df9-ba48-2e45d776f68f">
<p>
<code>avy</code> provides the ability to search for any character on the screen (not only in the current buffer!) - I enjoy this utility a lot and use it possibly even more often than the native vim commands.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package avy
  :bind
  (("M-o" . avy-goto-char-timer))
  :config
  (setq avy-all-windows 'all-frames))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:1c1821c6-98de-4079-a4f3-6ba6e6dcb668" class="outline-3">
<h3 id="h:1c1821c6-98de-4079-a4f3-6ba6e6dcb668"><span class="section-number-3">5.10.</span> crdt (Collaborative Editing)</h3>
<div class="outline-text-3" id="text-h:1c1821c6-98de-4079-a4f3-6ba6e6dcb668">
<p>
With this it is possible to work on the same file collaboratively. I have never tried it out, but it sounds cool.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package crdt)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:d9a6cb44-736e-4608-951f-e928e1b757c0" class="outline-3">
<h3 id="h:d9a6cb44-736e-4608-951f-e928e1b757c0"><span class="section-number-3">5.11.</span> devdocs</h3>
<div class="outline-text-3" id="text-h:d9a6cb44-736e-4608-951f-e928e1b757c0">
<p>
<code>devdocs</code> is a very nice package that provides documentation from <a href="https:devdocs.io">https:devdocs.io</a>. This is very useful since e.g. <code>pyright</code> provides only a very bad documentation and I do not want to leave Emacs all the time just to read documentation.
</p>

<p>
To install a documentation, use the <code>devdocs=install</code> command and select the appropriate version. <code>devdocs-update-all</code> can be used to download and reinstall all installed documents if a newer version is available. Check documentation with <code>devdocs-lookup</code> (<code>C-SPC h d</code>).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package devdocs)

(add-hook 'python-mode-hook
        (lambda () (setq-local devdocs-current-docs '("python~3.12" "numpy~1.23" "matplotlib~3.7" "pandas~1"))))
(add-hook 'python-ts-mode-hook
        (lambda () (setq-local devdocs-current-docs '("python~3.12" "numpy~1.23" "matplotlib~3.7" "pandas~1"))))

(add-hook 'c-mode-hook
        (lambda () (setq-local devdocs-current-docs '("c"))))
(add-hook 'c-ts-mode-hook
        (lambda () (setq-local devdocs-current-docs '("c"))))

(add-hook 'c++-mode-hook
        (lambda () (setq-local devdocs-current-docs '("cpp"))))
(add-hook 'c++-ts-mode-hook
        (lambda () (setq-local devdocs-current-docs '("cpp"))))

(devdocs-update-all)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:5cde5032-251e-4cc4-9202-b4ce996f92c2" class="outline-3">
<h3 id="h:5cde5032-251e-4cc4-9202-b4ce996f92c2"><span class="section-number-3">5.12.</span> Projectile</h3>
<div class="outline-text-3" id="text-h:5cde5032-251e-4cc4-9202-b4ce996f92c2">
<p>
projectile is useful for keeping track of your git projects within Emacs. I mostly use it to quickly switch between projects.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package projectile
  :diminish projectile-mode
  :config (projectile-mode)
  :custom ((projectile-completion-system 'auto)) ;; integrate ivy into completion system
  :bind-keymap
  ("C-c p" . projectile-command-map) ; all projectile commands under this
  :init
  ;; NOTE: Set this to the folder where you keep your Git repos!
  (when (file-directory-p swarsel-projects-directory)
    (setq projectile-project-search-path (list swarsel-projects-directory)))
(setq projectile-switch-project-action #'magit-status))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:d2c7323d-f8c6-4f23-b70a-930e3e4ecce5" class="outline-3">
<h3 id="h:d2c7323d-f8c6-4f23-b70a-930e3e4ecce5"><span class="section-number-3">5.13.</span> Magit</h3>
<div class="outline-text-3" id="text-h:d2c7323d-f8c6-4f23-b70a-930e3e4ecce5">
<p>
magit is the best git utility I have ever used - it has a beautiful interface and is very verbose. Here I mostly just setup the list of repositories that I want to expost to magit.
</p>

<p>
Also, Emacs needs a little extra love to accept my Yubikey for git commits etc. We also set that here.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package magit
  :config
  (setq magit-repository-directories `((,swarsel-projects-directory  . 1)
                                       (,swarsel-emacs-directory . 0)
                                       (,swarsel-obsidian-directory . 0)
                                       ("~/.dotfiles/" . 0)))
  :custom
  (magit-display-buffer-function #'magit-display-buffer-same-window-except-diff-v1)) ; stay in the same window

;; yubikey support for pushing commits
;; commiting is enabled through nixos gpg-agent config
(setq epg-pinentry-mode 'loopback)
(setenv "SSH_AUTH_SOCK" (string-chop-newline (shell-command-to-string "gpgconf --list-dirs agent-ssh-socket")))
</pre>
</div>
</div>
</div>

<div id="outline-container-h:1a8585ed-d9f2-478f-a132-440ada1cde2c" class="outline-3">
<h3 id="h:1a8585ed-d9f2-478f-a132-440ada1cde2c"><span class="section-number-3">5.14.</span> Forge</h3>
<div class="outline-text-3" id="text-h:1a8585ed-d9f2-478f-a132-440ada1cde2c">
<p>
NOTE: Make sure to configure a GitHub token before using this package!
</p>
<ul class="org-ul">
<li><a href="https://magit.vc/manual/forge/Token-Creation.html#Token-Creation">https://magit.vc/manual/forge/Token-Creation.html#Token-Creation</a></li>
<li><a href="https://magit.vc/manual/ghub/Getting-Started.html#Getting-Started">https://magit.vc/manual/ghub/Getting-Started.html#Getting-Started</a></li>
<li><a href="https://magit.vc/manual/ghub/Storing-a-Token.html">https://magit.vc/manual/ghub/Storing-a-Token.html</a></li>
<li><p>
<a href="https://www.emacswiki.org/emacs/GnuPG">https://www.emacswiki.org/emacs/GnuPG</a>
</p>

<p>
(1) in practice: github -&lt;&gt; settings -&lt;&gt; developer option -&lt;&gt;
    create classic token with repo; user; read:org permissions
(2) install GnuGP (and add to PATH)
(3) create ~/.authinfo.gpg with the following info scheme:
    machine api.github.com login USERNAME<sup>forge</sup> password 012345abcdef&#x2026;
</p></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package forge
  :after magit)

(with-eval-after-load 'forge
  (add-to-list 'forge-alist
               '("sgit.iue.tuwien.ac.at"
                 "sgit.iue.tuwien.ac.at/api/v1"
                 "sgit.iue.tuwien.ac.at"
                 forge-gitea-repository)))
</pre>
</div>
</div>
</div>

<div id="outline-container-h:cf5b0e6b-56a5-4a93-99fb-258eb7cb2eb4" class="outline-3">
<h3 id="h:cf5b0e6b-56a5-4a93-99fb-258eb7cb2eb4"><span class="section-number-3">5.15.</span> git-timemachine</h3>
<div class="outline-text-3" id="text-h:cf5b0e6b-56a5-4a93-99fb-258eb7cb2eb4">
<p>
This is just a nice utility to browse different versions of a file of a git project within Emacs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package git-timemachine
   :hook (git-time-machine-mode . evil-normalize-keymaps)
   :init (setq git-timemachine-show-minibuffer-details t))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:d9671ab7-a75a-47c6-a1f4-376d126c9b0a" class="outline-3">
<h3 id="h:d9671ab7-a75a-47c6-a1f4-376d126c9b0a"><span class="section-number-3">5.16.</span> Delimiters (brackets): rainbow-delimiters, highlight-parentheses</h3>
<div class="outline-text-3" id="text-h:d9671ab7-a75a-47c6-a1f4-376d126c9b0a">
<ul class="org-ul">
<li>rainbow-delimiters colors all delimiters, also ones not in current selection</li>
<li>paren highlights the current delimiter selection especially bold</li>
<li>highlight-parentheses boldly highlights all delimiters in current selection</li>
</ul>

<p>
I am not completely sure on electric-pair-mode yet, sometimes it is very helpful, sometimes it annoys me to no end.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
  (use-package rainbow-delimiters
    :hook (prog-mode . rainbow-delimiters-mode))

  (use-package highlight-parentheses
    :config
    (setq highlight-parentheses-colors '("black" "white" "black" "black" "black" "black" "black"))
    (setq highlight-parentheses-background-colors '("magenta" "blue" "cyan" "green" "yellow" "orange" "red"))
    (global-highlight-parentheses-mode t))

  (electric-pair-mode 1)
  (setq electric-pair-preserve-balance nil)
  ;; don't try to be overly smart
  (setq electric-pair-delete-adjacent-pairs nil)
  ;; don't skip newline when auto-pairing parenthesis
  (setq electric-pair-skip-whitespace-chars '(9 32))

  ;; in org-mode buffers, do not pair &lt; and &gt; in order not to interfere with org-tempo
(add-hook 'org-mode-hook (lambda ()
           (setq-local electric-pair-inhibit-predicate
                   `(lambda (c)
                  (if (char-equal c ?&lt;) t (,electric-pair-inhibit-predicate c))))))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:d1a32a69-2f9a-45ef-95fe-a00e3551dc94" class="outline-3">
<h3 id="h:d1a32a69-2f9a-45ef-95fe-a00e3551dc94"><span class="section-number-3">5.17.</span> rainbow-mode</h3>
<div class="outline-text-3" id="text-h:d1a32a69-2f9a-45ef-95fe-a00e3551dc94">
<p>
Complimentary to the delimiters-packages above, this package sets the background color of the delimiters, which makes it easier to see at a glance where we are in a delimiter-tree.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package rainbow-mode
  :config (rainbow-mode))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:5653d693-ecca-4c95-9633-66b9e3241070" class="outline-3">
<h3 id="h:5653d693-ecca-4c95-9633-66b9e3241070"><span class="section-number-3">5.18.</span> Corfu</h3>
<div class="outline-text-3" id="text-h:5653d693-ecca-4c95-9633-66b9e3241070">
<p>
This is the company equivalent to the vertico gang.
I dislike the standard behaviour that makes the cursor move into the completion framework on presses of <code>&lt;up&gt;</code> and <code>&lt;down&gt;</code>.
</p>

<p>
Nerd icons is originally enabled here: <a href="#h:eb0ea526-a83a-4664-b3a1-2b40d3a31493">Icons</a>
</p>

<p>
Navigation functions defined here: <a href="#h:a1802f9b-bb71-4fd5-86fa-945da18e8b81">corfu: Do not interrupt navigation</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; (use-package corfu
;;   :custom
;;   (corfu-cycle t)
;;   :init
;;   (global-corfu-mode))

(use-package corfu
  :init
  (global-corfu-mode)
  (corfu-history-mode)
  (corfu-popupinfo-mode) ; Popup completion info
  :custom
  (corfu-auto t)
  (corfu-auto-prefix 3)
  (corfu-auto-delay 0.3)
  (corfu-cycle t)
  (corfu-quit-no-match 'separator)
  (corfu-separator ?\s)
  ;; (corfu-quit-no-match t)
  (corfu-popupinfo-max-height 70)
  (corfu-popupinfo-delay '(0.5 . 0.2))
  ;; (corfu-preview-current 'insert) ; insert previewed candidate
  (corfu-preselect 'prompt)
  (corfu-on-exact-match nil)      ; Don't auto expand tempel snippets
  ;; Optionally use TAB for cycling, default is `corfu-complete'.
  :bind (:map corfu-map
              ("M-SPC"      . corfu-insert-separator)
              ("&lt;return&gt;" . swarsel/corfu-normal-return)
              ;; ("C-&lt;return&gt;" . swarsel/corfu-complete)
              ("S-&lt;up&gt;" . corfu-popupinfo-scroll-down)
              ("S-&lt;down&gt;" . corfu-popupinfo-scroll-up)
              ("C-&lt;up&gt;" . corfu-previous)
              ("C-&lt;down&gt;" . corfu-next)
              ("&lt;insert-state&gt; &lt;up&gt;"      . swarsel/corfu-quit-and-up)
              ("&lt;insert-state&gt; &lt;down&gt;"     . swarsel/corfu-quit-and-down))
  )

(use-package nerd-icons-corfu)

(add-to-list 'corfu-margin-formatters #'nerd-icons-corfu-formatter)

(setq nerd-icons-corfu-mapping
      '((array :style "cod" :icon "symbol_array" :face font-lock-type-face)
        (boolean :style "cod" :icon "symbol_boolean" :face font-lock-builtin-face)
        ;; ...
        (t :style "cod" :icon "code" :face font-lock-warning-face)))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:c3cc1c12-3ab8-42b7-be07-63f54eac397f" class="outline-3">
<h3 id="h:c3cc1c12-3ab8-42b7-be07-63f54eac397f"><span class="section-number-3">5.19.</span> cape</h3>
<div class="outline-text-3" id="text-h:c3cc1c12-3ab8-42b7-be07-63f54eac397f">
<p>
cape adds even more completion capabilities by adding a lot of completion logic that is exposed as separate functions. I tried out adding these to the <code>completion-at-points-functions</code> alist, but I felt like it cluttered my suggestions too much. Hence I now just call the respective functions when I need them. For this I setup the <code>C-z</code> keybinding in <a href="#h:218376e8-086b-46bf-91b3-78295d5d440f">General evil</a>.
</p>

<p>
I leave the commented out alist extensions here in case I want to try them out at some point in the future.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package cape
  :bind
  ("C-z p" . completion-at-point) ;; capf
  ("C-z t" . complete-tag)        ;; etags
  ("C-z d" . cape-dabbrev)        ;; or dabbrev-completion
  ("C-z h" . cape-history)
  ("C-z f" . cape-file)
  ("C-z k" . cape-keyword)
  ("C-z s" . cape-elisp-symbol)
  ("C-z e" . cape-elisp-block)
  ("C-z a" . cape-abbrev)
  ("C-z l" . cape-line)
  ("C-z w" . cape-dict)
  ("C-z :" . cape-emoji)
  ("C-z \\" . cape-tex)
  ("C-z _" . cape-tex)
  ("C-z ^" . cape-tex)
  ("C-z &amp;" . cape-sgml)
  ("C-z r" . cape-rfc1345)
  ;; Add to the global default value of `completion-at-point-functions' which is
  ;; used by `completion-at-point'.  The order of the functions matters, the
  ;; first function returning a result wins.  Note that the list of buffer-local
  ;; completion functions takes precedence over the global list.
  ;; (add-to-list 'completion-at-point-functions #'cape-dabbrev)
  ;; (add-to-list 'completion-at-point-functions #'cape-file)
  ;; (add-to-list 'completion-at-point-functions #'cape-elisp-block)
  ;; (add-to-list 'completion-at-point-functions #'cape-history)
  ;; (add-to-list 'completion-at-point-functions #'cape-keyword)
  ;; (add-to-list 'completion-at-point-functions #'cape-tex)
  ;; (add-to-list 'completion-at-point-functions #'cape-sgml)
  ;; (add-to-list 'completion-at-point-functions #'cape-rfc1345)
  ;; (add-to-list 'completion-at-point-functions #'cape-abbrev)
  ;; (add-to-list 'completion-at-point-functions #'cape-dict)
  ;; (add-to-list 'completion-at-point-functions #'cape-elisp-symbol)
  ;; (add-to-list 'completion-at-point-functions #'cape-line)
)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:3aa20438-edf6-4b13-a90d-3d5c51239c44" class="outline-3">
<h3 id="h:3aa20438-edf6-4b13-a90d-3d5c51239c44"><span class="section-number-3">5.20.</span> rust</h3>
<div class="outline-text-3" id="text-h:3aa20438-edf6-4b13-a90d-3d5c51239c44">
<p>
This is supposed to setup a rust-lsp - however, this has not worked nicely in the past and this configuration section is just a ruin really. I need to check what works and clean this up.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
  ;; (use-package rustic
  ;;   :ensure
  ;;   :bind (:map rustic-mode-map
  ;;               ("M-j" . lsp-ui-imenu)
  ;;               ("M-?" . lsp-find-references)
  ;;               ("C-c C-c l" . flycheck-list-errors)
  ;;               ("C-c C-c a" . lsp-execute-code-action)
  ;;               ("C-c C-c r" . lsp-rename)
  ;;               ("C-c C-c q" . lsp-workspace-restart)
  ;;               ("C-c C-c Q" . lsp-workspace-shutdown)
  ;;               ("C-c C-c s" . lsp-rust-analyzer-status))
  ;;   :config

  ;;   (setq rustic-format-on-save t)
  ;;   (add-hook 'rustic-mode-hook 'rk/rustic-mode-hook))

;;   (defun rk/rustic-mode-hook ()
;;     ;; so that run C-c C-c C-r works without having to confirm, but don't try to
;;     ;; save rust buffers that are not file visiting. Once
;;     ;; https://github.com/brotzeit/rustic/issues/253 has been resolved this should
;;     ;; no longer be necessary.
;;     (when buffer-file-name
;;       (setq-local buffer-save-without-query t))
;;     (add-hook 'before-save-hook 'lsp-format-buffer nil t))

;; (use-package rustic
;;   :config
;;   (setq rustic-format-on-save t)
;;   (setq rustic-lsp-client 'eglot)
;;   :custom
;;   (lsp-rust-analyzer-cargo-watch-command "clippy")
;;   (lsp-rust-analyzer-server-display-inlay-hints t)
;;   :mode ("\\.rs" . rustic-mode))

(use-package rustic
  :config
  (setq rustic-format-on-save t)
  (setq rustic-lsp-client 'eglot)
  :mode ("\\.rs" . rustic-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-h:b9b27a88-06f3-470b-a604-a20b2079bc26" class="outline-3">
<h3 id="h:b9b27a88-06f3-470b-a604-a20b2079bc26"><span class="section-number-3">5.21.</span> Tramp</h3>
<div class="outline-text-3" id="text-h:b9b27a88-06f3-470b-a604-a20b2079bc26">
<p>
Tramp allows for SSH access of files over Emacs. I have no ideas what the options here mean, but this is a recommended configuration that I found (sadly I lost the link). I need to research more what these options really do.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">


(use-package tramp
  :init
  (setq vc-ignore-dir-regexp
        (format "\\(%s\\)\\|\\(%s\\)"
                vc-ignore-dir-regexp
                tramp-file-name-regexp))
  (setq tramp-default-method "ssh")
  (setq tramp-auto-save-directory
        (expand-file-name "tramp-auto-save" user-emacs-directory))
  (setq tramp-persistency-file-name
        (expand-file-name "tramp-connection-history" user-emacs-directory))
  (setq password-cache-expiry nil)
  (setq tramp-use-ssh-controlmaster-options nil)
  (setq remote-file-name-inhibit-cache nil)
  :config
  (customize-set-variable 'tramp-ssh-controlmaster-options
                          (concat
                           "-o ControlPath=/tmp/ssh-tramp-%%r@%%h:%%p "
                           "-o ControlMaster=auto -o ControlPersist=yes"))
)



</pre>
</div>
</div>
</div>

<div id="outline-container-h:58415e95-8a7a-4517-acbb-5f1bb1028603" class="outline-3">
<h3 id="h:58415e95-8a7a-4517-acbb-5f1bb1028603"><span class="section-number-3">5.22.</span> diff-hl</h3>
<div class="outline-text-3" id="text-h:58415e95-8a7a-4517-acbb-5f1bb1028603">
<p>
This is a simple highlighting utility that uses the margin to visually show the differences since the last git commit.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package diff-hl
  :hook
  ((prog-mode
    org-mode) . diff-hl-mode)
  :init
  (diff-hl-flydiff-mode)
  (diff-hl-margin-mode)
  (diff-hl-show-hunk-mouse-mode))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:d60ce0b1-cabf-43f5-a236-a1e4b400d2f5" class="outline-3">
<h3 id="h:d60ce0b1-cabf-43f5-a236-a1e4b400d2f5"><span class="section-number-3">5.23.</span> Commenting</h3>
<div class="outline-text-3" id="text-h:d60ce0b1-cabf-43f5-a236-a1e4b400d2f5">
<p>
This package allows for swift commenting out and in of code snippets. For some reason, it is a bit broken in my config, as it sometimes comments out too much, sometimes too little, and sometimes it splits lines during commenting. Also, in org-mode when inside a src-block, it often times jumps to the top of the block.
</p>

<p>
Still, this is avery convenient package.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package evil-nerd-commenter
  :bind ("M-/" . evilnc-comment-or-uncomment-lines))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:9ec11ee4-2250-414a-87b5-73ee680a3a4a" class="outline-3">
<h3 id="h:9ec11ee4-2250-414a-87b5-73ee680a3a4a"><span class="section-number-3">5.24.</span> yasnippet</h3>
<div class="outline-text-3" id="text-h:9ec11ee4-2250-414a-87b5-73ee680a3a4a">
<p>
yasnippet allows to define snippets that can be quickly expanded by hitting the <code>TAB</code> key after inputting a keyword.
</p>

<p>
I used to run this together with the <code>yasnippet-snippets</code> package, but the snippets in there I did not find all too useful for myself. I need to create some custom snippets here one day.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package yasnippet
  :init (yas-global-mode 1)
  :config
  (yas-reload-all))

</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org910308c"></a>yasnippet math-snippets<br />
<div class="outline-text-5" id="text-5-24-0-1">
<p>
The following block is mostly inspired from <a href="https://code.kulupu.party/thesuess/WTFmacs/">https://code.kulupu.party/thesuess/WTFmacs/</a> and sets up a few prefixes that make LaTeX-math-mode nicer to use even with auctex and cape enabled.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">

(setq wtf/latex-mathbb-prefix "''")
(setq swarsel/latex-mathcal-prefix "``")

(use-package yasnippet
  :config

  (setq wtf/english-alphabet
        '("a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"))

  (dolist (elem wtf/english-alphabet)
    (when (string-equal elem (downcase elem))
      (add-to-list 'wtf/english-alphabet (upcase elem))))


  (yas-define-snippets
   'latex-mode
   (mapcar
    (lambda (elem)
      (list (concat wtf/latex-mathbb-prefix elem) (concat "\\mathbb{" elem "}") (concat "Mathbb letter " elem)))
    wtf/english-alphabet))

  (yas-define-snippets
   'latex-mode
   (mapcar
    (lambda (elem)
      (list (concat swarsel/latex-mathcal-prefix elem) (concat "\\mathcal{" elem "}") (concat "Mathcal letter " elem)))
    wtf/english-alphabet))

  (setq swtf/latex-math-symbols
        '(("x" . "\\times")
          ("*" . "\\cdot")
          ("." . "\\ldots")
          ("op" . "\\operatorname{$1}$0")
          ("o" . "\\circ")
          ("V" . "\\forall")
          ("v" . "\\vee")
          ("w" . "\\wedge")
          ("q" . "\\quad")
          ("f" . "\\frac{$1}{$2}$0")
          ("s" . "\\sum_{$1}^{$2}$0")
          ("p" . "\\prod_{$1}^{$2}$0")
          ("e" . "\\exists")
          ("i" . "\\int_{$1}^{$2}$0")
          ("c" . "\\cap")
          ("u" . "\\cup")
          ("0" . "\\emptyset")))

  )


</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org8a3df1c" class="outline-3">
<h3 id="org8a3df1c"><span class="section-number-3">5.25.</span> eglot</h3>
<div class="outline-text-3" id="text-5-25">
<p>
After having tried out <code>lsp-mode</code> and <code>lsp-bridge</code> for a while each, I must say that <code>eglot</code> feels the most clean and fast to me. Rust-modes need a little extra care to get working here.
</p>

<p>
:CUSTOM<sub>ID</sub>: h:424fbc62-84e2-42c7-a1ca-e43ea04c43e5
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package eglot
  :ensure nil
  :hook
  ((python-mode
    python-ts-mode
    c-mode
    c-ts-mode
    c++-mode
    c++-ts-mode
    tex-mode
    LaTeX-mode
    ) . (lambda () (progn
                     (eglot-ensure)
                     (add-hook 'before-save-hook 'eglot-format nil 'local))))
  :custom
  (eldoc-echo-area-use-multiline-p nil)
  (completion-category-defaults nil)
  :config
  ;; (push '(rustic-ts-mode . eglot-rust-analyzer) eglot-server-programs)
  (push '(rustic-mode . eglot-rust-analyzer) eglot-server-programs)
  (add-to-list 'eglot-server-programs '((rust-mode) . (eglot-rust-analyzer "rust-analyzer")))
  ;; (add-to-list 'eglot-server-programs '((python-mode) . ("pylsp")))
  ;; (add-to-list 'eglot-server-programs '((c-mode) . ("clangd")))
  :bind (:map eglot-mode-map
              ("M-(" . flymake-goto-next-error)
              ("C-c ," . eglot-code-actions)))

(defalias 'start-lsp-server #'eglot)

</pre>
</div>
</div>
</div>

<div id="outline-container-org0d359ae" class="outline-3">
<h3 id="org0d359ae"><span class="section-number-3">5.26.</span> Breadcrumb</h3>
<div class="outline-text-3" id="text-5-26">
<p>
This simple shows the path to the current file on the top of the buffer - I just think it looks kind of neat, even though it is not extremely useful :)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package breadcrumb
  :config (breadcrumb-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:e9a30d0f-423f-4e85-af4b-f8560f1c1b53" class="outline-3">
<h3 id="h:e9a30d0f-423f-4e85-af4b-f8560f1c1b53"><span class="section-number-3">5.27.</span> Prevent breaking of hardlinks</h3>
<div class="outline-text-3" id="text-h:e9a30d0f-423f-4e85-af4b-f8560f1c1b53">
<p>
This setting ensures that hard links are preserved during the backup process, which is useful for maintaining the integrity of files that are linked in multiple locations.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq backup-by-copying-when-linked t)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:0918557a-8463-430c-b8df-6546dea9abd0" class="outline-3">
<h3 id="h:0918557a-8463-430c-b8df-6546dea9abd0"><span class="section-number-3">5.28.</span> Dirvish</h3>
<div class="outline-text-3" id="text-h:0918557a-8463-430c-b8df-6546dea9abd0">
<p>
Dirvish is an improvement upon the dired-framework and has more features like file preview etc. Sadly it has an incompatibility with <code>openwith</code> which is why I have disabled that package.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package dirvish
  :init
  (dirvish-override-dired-mode)
  :config
  (dirvish-peek-mode)
  (dirvish-side-follow-mode)
  (setq dirvish-open-with-programs
        (append dirvish-open-with-programs '(
                                             (("xlsx" "docx" "doc" "odt" "ods") "libreoffice" "%f")
                                             (("jpg" "jpeg" "png")              "imv" "%f")
                                             (("pdf")                           "sioyek" "%f")
                                             (("xopp")                          "xournalpp" "%f"))))
  :custom
  (delete-by-moving-to-trash t)
  (dired-listing-switches
   "-l --almost-all --human-readable --group-directories-first --no-group")
  (dirvish-attributes
   '(vc-state subtree-state nerd-icons collapse file-time file-size))
  (dirvish-quick-access-entries
   '(("h" "~/"              "Home")
     ("c" "~/.dotfiles/"    "Config")
     ("d" "~/Downloads/"    "Downloads")
     ("D" "~/Documents/"    "Documents")
     ("p" "~/Documents/GitHub/"  "Projects")
     ("/" "/"               "Root")))
  :bind
  (("&lt;DUMMY-i&gt; d" . 'dirvish)
   ("C-=" . 'dirvish-side)
   :map dirvish-mode-map
   ("h"   . dired-up-directory)
   ("&lt;left&gt;"   . dired-up-directory)
   ("l"   . dired-find-file)
   ("&lt;right&gt;"   . dired-find-file)
   ("j"   . evil-next-visual-line)
   ("k"   . evil-previous-visual-line)
   ("a"   . dirvish-quick-access)
   ("f"   . dirvish-file-info-menu)
   ("z"   . dirvish-history-last)
   ("J"   . dirvish-history-jump)
   ("y"   . dirvish-yank-menu)
   ("/"   . dirvish-narrow)
   ("TAB" . dirvish-subtree-toggle)
   ("M-f" . dirvish-history-go-forward)
   ("M-b" . dirvish-history-go-backward)
   ("M-l" . dirvish-ls-switches-menu)
   ("M-m" . dirvish-mark-menu)
   ("M-t" . dirvish-layout-toggle)
   ("M-s" . dirvish-setup-menu)
   ("M-e" . dirvish-emerge-menu)
   ("M-j" . dirvish-fd-jump)))

</pre>
</div>
</div>
</div>
<div id="outline-container-h:b108dd3e-f34d-4ed3-98df-0bf9de055889" class="outline-3">
<h3 id="h:b108dd3e-f34d-4ed3-98df-0bf9de055889"><span class="section-number-3">5.29.</span> pdf-tools: pdf-viewer and support for dirvish</h3>
<div class="outline-text-3" id="text-h:b108dd3e-f34d-4ed3-98df-0bf9de055889">
<p>
This enables pdf-previewing in dirvish and gives a much better pdf-viewer than is shipped normally by emacs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package pdf-tools
  :init
  (if (not (boundp 'pdf-tools-directory))
      (pdf-tools-install))
  :mode ("\\.pdf" . pdf-view-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:c15efae7-b884-4c97-8367-ccc7e7ed9ba8" class="outline-3">
<h3 id="h:c15efae7-b884-4c97-8367-ccc7e7ed9ba8"><span class="section-number-3">5.30.</span> Jupyter</h3>
<div class="outline-text-3" id="text-h:c15efae7-b884-4c97-8367-ccc7e7ed9ba8">
<p>
This is a jupyter client. Using it is a bit cumbersome though, so I have not fully explored all features.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package ein)

</pre>
</div>
</div>
</div>

<div id="outline-container-h:1fc538d1-8c53-48b2-8652-66046f4bbbf8" class="outline-3">
<h3 id="h:1fc538d1-8c53-48b2-8652-66046f4bbbf8"><span class="section-number-3">5.31.</span> undo-tree</h3>
<div class="outline-text-3" id="text-h:1fc538d1-8c53-48b2-8652-66046f4bbbf8">
<p>
Base emacs undo logic is very useful, but not easy to understand for me. I prefer undo-tree, which makes switching between branches easier and also allows quickly switching back to a much older state using the visualizer.
</p>

<p>
Evil needs to be told to use this mode, see <code>(evil-set-undo-system 'undo-tree)</code> in <a href="#h:218376e8-086b-46bf-91b3-78295d5d440f">Evil/General.</a>
</p>

<p>
By default, I am not using undo-tree-mode in every buffer. This might change in the future, but for now this is fine. It can be enabled manually should the need arise.
</p>

<p>
While we are at it, we are also setting up a persistent undo-file for every file that we are working with.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package undo-tree
  ;; :init (global-undo-tree-mode)
  :bind (:map undo-tree-visualizer-mode-map
              ("h" . undo-tree-visualize-switch-branch-left)
              ("l" . undo-tree-visualize-switch-branch-left)
              ("j" . undo-tree-visualize-redo)
              ("k" . undo-tree-visualize-undo))
  :config
  (setq undo-tree-history-directory-alist '(("." . "~/.emacs.d/undo"))))

(add-hook 'prog-mode-hook 'undo-tree-mode)
(add-hook 'text-mode-hook 'undo-tree-mode)
(add-hook 'org-mode-hook 'undo-tree-mode)
(add-hook 'latex-mode-hook 'undo-tree-mode)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b6c18dd0-3377-47ea-80c3-ac1486454e18" class="outline-3">
<h3 id="h:b6c18dd0-3377-47ea-80c3-ac1486454e18"><span class="section-number-3">5.32.</span> Hydra</h3>
<div class="outline-text-3" id="text-h:b6c18dd0-3377-47ea-80c3-ac1486454e18">
<p>
Hydra allows for the writing of macro-style functions. I have not yet looked into this all too much, but it seems to be a potent feature.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package hydra)

</pre>
</div>
</div>

<div id="outline-container-h:c5681884-7040-4b55-ab1b-5777631a0514" class="outline-4">
<h4 id="h:c5681884-7040-4b55-ab1b-5777631a0514"><span class="section-number-4">5.32.1.</span> Text scaling</h4>
<div class="outline-text-4" id="text-h:c5681884-7040-4b55-ab1b-5777631a0514">
<p>
I only wrote this in order to try out hydra; rarely do I really need this. However, it can be useful for <a href="#h:4e11a845-a7bb-4eb5-b4ce-5b2f52e07425">Presentations</a>. It simply scales the text size.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">

;; change the text size of the current buffer
(defhydra hydra-text-scale (:timeout 4)
  "scale text"
  ("j" text-scale-increase "in")
  ("k" text-scale-decrease "out")
  ("f" nil "finished" :exit t))

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:fff816a0-6d70-4bda-abab-833345e51100" class="outline-3">
<h3 id="h:fff816a0-6d70-4bda-abab-833345e51100"><span class="section-number-3">5.33.</span> External Applications</h3>
<div class="outline-text-3" id="text-h:fff816a0-6d70-4bda-abab-833345e51100">
</div>
<div id="outline-container-h:9335d32d-bf08-4601-820d-f3d1f33f876f" class="outline-4">
<h4 id="h:9335d32d-bf08-4601-820d-f3d1f33f876f"><span class="section-number-4">5.33.1.</span> Obsidian</h4>
<div class="outline-text-4" id="text-h:9335d32d-bf08-4601-820d-f3d1f33f876f">
<p>
This provides an interface to Obsidian for Emacs - as much as I want to like it, I actually enjoy using the official Obsidian app more - even though that cannot be used by Emacs directly.
</p>

<p>
My workflow for Obsidian is now as follows:
</p>

<ol class="org-ol">
<li>create notes either in Emacs or Obsidian</li>
<li><p>
look at them in the official client
</p>

<p>
I hope that this package will improve, then I will come back to it one day.
</p></li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; (use-package obsidian
;;   :ensure t
;;   :demand t
;;   :config
;;   (obsidian-specify-path swarsel-obsidian-vault-directory)
;;   (global-obsidian-mode t)
;;   :custom
;;   ;; This directory will be used for `obsidian-capture' if set.
;;   (obsidian-inbox-directory "Inbox")
;;   (bind-key (kbd "C-c M-o") 'obsidian-hydra/body 'obsidian-mode-map)
;;   :bind (:map obsidian-mode-map
;;               ;; Replace C-c C-o with Obsidian.el's implementation. It's ok to use another key binding.
;;               ("C-c C-o" . obsidian-follow-link-at-point)
;;               ;; Jump to backlinks
;;               ("C-c C-b" . obsidian-backlink-jump)
;;               ;; If you prefer you can use `obsidian-insert-link'
;;               ("C-c C-l" . obsidian-insert-wikilink)))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:5854c9a6-1319-4961-a112-75b1bf2e1f69" class="outline-4">
<h4 id="h:5854c9a6-1319-4961-a112-75b1bf2e1f69"><span class="section-number-4">5.33.2.</span> Anki</h4>
<div class="outline-text-4" id="text-h:5854c9a6-1319-4961-a112-75b1bf2e1f69">
<p>
This section is here to make Anki usable from within Emacs - an endeavour that I have mostly given up on.
</p>
</div>

<ol class="org-ol">
<li><a id="h:d20559ed-7ada-4fea-a964-33bfd64b4549"></a>Basic Anki setup<br />
<div class="outline-text-5" id="text-h:d20559ed-7ada-4fea-a964-33bfd64b4549">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; (use-package anki-editor
;;   :after org
;;   :bind (:map org-mode-map
;;               ("&lt;f12&gt;" . anki-editor-cloze-region-auto-incr)
;;               ("&lt;f11&gt;" . anki-editor-cloze-region-dont-incr)
;;               ("&lt;f10&gt;" . anki-editor-reset-cloze-number)
;;               ("&lt;f9&gt;"  . anki-editor-push-tree))
;;   :hook (org-capture-after-finalize . anki-editor-reset-cloze-number) ; Reset cloze-number after each capture.
;;   :config
;;   (setq anki-editor-create-decks t ;; Allow anki-editor to create a new deck if it doesn't exist
;;         anki-editor-org-tags-as-anki-tags t)

;;   (defun anki-editor-cloze-region-auto-incr (&amp;optional arg)
;;     "Cloze region without hint and increase card number."
;;     (interactive)
;;     (anki-editor-cloze-region swarsel-anki-editor-cloze-number "")
;;     (setq swarsel-anki-editor-cloze-number (1+ swarsel-anki-editor-cloze-number))
;;     (forward-sexp))
;;   (defun anki-editor-cloze-region-dont-incr (&amp;optional arg)
;;     "Cloze region without hint using the previous card number."
;;     (interactive)
;;     (anki-editor-cloze-region (1- swarsel-anki-editor-cloze-number) "")
;;     (forward-sexp))
;;   (defun anki-editor-reset-cloze-number (&amp;optional arg)
;;     "Reset cloze number to ARG or 1"
;;     (interactive)
;;     (setq swarsel-anki-editor-cloze-number (or arg 1)))
;;   (defun anki-editor-push-tree ()
;;     "Push all notes under a tree."
;;     (interactive)
;;     (anki-editor-push-notes '(4))
;;     (anki-editor-reset-cloze-number))
;;   ;; Initialize
;;   (anki-editor-reset-cloze-number)
;;   )

;; (require 'anki-editor)

</pre>
</div>
</div>
</li>

<li><a id="h:64242e95-6454-4330-bcb9-15353083bade"></a>Own Anki functions<br />
<div class="outline-text-5" id="text-h:64242e95-6454-4330-bcb9-15353083bade">
<ul class="org-ul">
<li>These functions enable you to quickly set the destination note type and deck</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; (defvar swarsel-anki-deck nil)
;; (defvar swarsel-anki-notetype nil)
;; (defvar swarsel-anki-fields nil)

;; (defun swarsel-anki-set-deck-and-notetype ()
;;   (interactive)
;;   (setq swarsel-anki-deck  (completing-read "Choose a deck: "
;;                                             (sort (anki-editor-deck-names) #'string-lessp)))
;;   (setq swarsel-anki-notetype (completing-read "Choose a note type: "
;;                                                (sort (anki-editor-note-types) #'string-lessp)))
;;   (setq swarsel-anki-fields (progn
;;                               (anki-editor--anki-connect-invoke-result "modelFieldNames" `((modelName . ,swarsel-anki-notetype)))))
;;   )

;; (defun swarsel-anki-make-template-string ()
;;   (if (not swarsel-anki-deck)
;;       (call-interactively 'swarsel-anki-set-deck-and-notetype))
;;   (setq swarsel-temp swarsel-anki-fields)
;;   (concat (concat "* %&lt;%H:%M&gt;\n:PROPERTIES:\n:ANKI_NOTE_TYPE: " swarsel-anki-notetype "\n:ANKI_DECK: " swarsel-anki-deck "\n:END:\n** ")(pop swarsel-temp) "\n%?\n** " (mapconcat 'identity swarsel-temp "\n\n** ") "\n\n"))

;; (defun swarsel-today()
;;   (format-time-string "%Y-%m-%d"))

;; (defun swarsel-obsidian-daily ()
;;   (interactive)
;;   (if (not (file-exists-p (expand-file-name (concat (swarsel-today) ".md") swarsel-obsidian-daily-directory)))
;;       (write-region "" nil (expand-file-name (concat (swarsel-today) ".md") swarsel-obsidian-daily-directory))
;;     )
;;   (find-file (expand-file-name (concat (swarsel-today) ".md") swarsel-obsidian-daily-directory)))

</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-h:2f333330-b19d-4f64-85ea-146ff28667e8" class="outline-3">
<h3 id="h:2f333330-b19d-4f64-85ea-146ff28667e8"><span class="section-number-3">5.34.</span> Email + Calendar</h3>
<div class="outline-text-3" id="text-h:2f333330-b19d-4f64-85ea-146ff28667e8">
</div>
<div id="outline-container-h:48fde614-7cd0-4764-a7ac-0dae60d8b65a" class="outline-4">
<h4 id="h:48fde614-7cd0-4764-a7ac-0dae60d8b65a"><span class="section-number-4">5.34.1.</span> make sure mu4e is found</h4>
<div class="outline-text-4" id="text-h:48fde614-7cd0-4764-a7ac-0dae60d8b65a">
<p>
This seems not to be needed - I do not yet dare to delete it though.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; (let ((mu4epath
;;        (concat
;;         (f-dirname
;;          (file-truename
;;           (executable-find "mu")))
;;         "/../share/emacs/site-lisp/mu4e")))
;;   (when (and
;;          (string-prefix-p "/nix/store/" mu4epath)
;;          (file-directory-p mu4epath))
;;     (add-to-list 'load-path mu4epath)))

</pre>
</div>
</div>
</div>

<div id="outline-container-h:b92a18cf-eec3-4605-a8c2-37133ade3574" class="outline-4">
<h4 id="h:b92a18cf-eec3-4605-a8c2-37133ade3574"><span class="section-number-4">5.34.2.</span> mu4e</h4>
<div class="outline-text-4" id="text-h:b92a18cf-eec3-4605-a8c2-37133ade3574">
<p>
In this section we are setting up mu4e, a mail client for emacs using mu with mbsync as backend. The mail accounts themselves are setup in the NixOS configuration, so we only need to add Emacs specific settings here.
</p>

<p>
The hook functions are defined here: <a href="#h:34506761-06b9-43b5-a818-506d9b3faf28">mu4e functions</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package mu4e
  :ensure nil
  ;; :load-path "/usr/share/emacs/site-lisp/mu4e/"
  ;;:defer 20 ; Wait until 20 seconds after startup
  :config

  ;; This is set to 't' to avoid mail syncing issues when using mbsync
  (setq send-mail-function 'sendmail-send-it)
  (setq mu4e-change-filenames-when-moving t)
  (setq mu4e-mu-binary (executable-find "mu"))
  (setq mu4e-hide-index-messages t)

  (setq mu4e-update-interval 180)
  (setq mu4e-get-mail-command "mbsync -a")
  (setq mu4e-maildir "~/Mail")

  ;; enable inline images
  (setq mu4e-view-show-images t)
  ;; use imagemagick, if available
  (when (fboundp 'imagemagick-register-types)
    (imagemagick-register-types))

  (setq mu4e-drafts-folder "/Drafts")
  (setq mu4e-sent-folder   "/Sent Mail")
  (setq mu4e-refile-folder "/All Mail")
  (setq mu4e-trash-folder  "/Trash")

  (setq mu4e-maildir-shortcuts
        '((:maildir "/leon/Inbox"    :key ?1)
          (:maildir "/nautilus/Inbox" :key ?2)
          (:maildir "/mrswarsel/Inbox"     :key ?3)
          (:maildir "/Sent Mail"     :key ?s)
          (:maildir "/Trash"     :key ?t)
          (:maildir "/Drafts"     :key ?d)
          (:maildir "/All Mail"     :key ?a)))

(setq user-mail-address "leon@swarsel.win"
      user-full-name "Leon Schwarzäugl")


(setq mu4e-user-mail-address-list '(leon.schwarzaeugl@gmail.com leon@swarsel.win nautilus.dw@gmail.com mrswarsel@gmail.com)))


(add-hook 'mu4e-compose-mode-hook #'swarsel/mu4e-send-from-correct-address)
(add-hook 'mu4e-compose-post-hook #'swarsel/mu4e-restore-default)
</pre>
</div>
</div>
</div>

<div id="outline-container-h:43209eeb-5d46-472e-b7c2-58a3fb465199" class="outline-4">
<h4 id="h:43209eeb-5d46-472e-b7c2-58a3fb465199"><span class="section-number-4">5.34.3.</span> mu4e-alert</h4>
<div class="outline-text-4" id="text-h:43209eeb-5d46-472e-b7c2-58a3fb465199">
<p>
This adds the simple utility of sending desktop notifications whenever a new mail is received. I am using <code>libnotify</code> because I want to use this with <code>notify-send</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package mu4e-alert
:config
(setq mu4e-alert-set-default-style 'libnotify))

(add-hook 'after-init-hook #'mu4e-alert-enable-notifications)

(mu4e t)
</pre>
</div>
</div>
</div>

<div id="outline-container-h:c760f04e-622f-4b3e-8916-53ca8cce6edc" class="outline-4">
<h4 id="h:c760f04e-622f-4b3e-8916-53ca8cce6edc"><span class="section-number-4">5.34.4.</span> Calendar</h4>
<div class="outline-text-4" id="text-h:c760f04e-622f-4b3e-8916-53ca8cce6edc">
<p>
This provides a beautiful calender to emacs.
</p>

<p>
Yes, I am aware that I am exposing my university-calendar to the public here. I can imagine worse things ;) if you however know how to obscure this, let me know!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package org-caldav
  :init
  ;; set org-caldav-sync-initalization
  (setq swarsel-caldav-synced 0)
  (setq org-caldav-url "https://stash.swarsel.win/remote.php/dav/calendars/Swarsele")
  (setq org-caldav-calendars
        '((:calendar-id "personal"
                        :inbox "~/Calendars/leon_cal.org")))
  ;; (setq org-caldav-backup-file "~/org-caldav/org-caldav-backup.org")
  ;; (setq org-caldav-save-directory "~/org-caldav/")

  :config
  (setq org-icalendar-alarm-time 1)
  ;; This makes sure to-do items as a category can show up on the calendar
  (setq org-icalendar-include-todo t)
  ;; This ensures all org "deadlines" show up, and show up as due dates
  (setq org-icalendar-use-deadline '(event-if-todo event-if-not-todo todo-due))
  ;; This ensures "scheduled" org items show up, and show up as start times
  (setq org-icalendar-use-scheduled '(todo-start event-if-todo event-if-not-todo))
  )

(use-package calfw
  :ensure nil
  :bind ("C-c A" . swarsel/open-calendar)
  :init
  (use-package calfw-cal
    :ensure nil)
  (use-package calfw-org
    :ensure nil)
  (use-package calfw-ical
    :ensure nil)
  :config
  (bind-key "g" 'cfw:refresh-calendar-buffer cfw:calendar-mode-map)
  (bind-key "q" 'evil-quit cfw:details-mode-map)
  ;; (custom-set-faces
  ;;  '(cfw:face-title ((t (:foreground "#f0dfaf" :weight bold :height 65))))
  ;; )
  )

(defun swarsel/open-calendar ()
  (interactive)
  (unless (eq swarsel-caldav-synced 1) (org-caldav-sync) (setq swarsel-caldav-synced 1))
  ;;  (select-frame (make-frame '((name . "calendar")))) ; makes a new frame and selects it
  ;; (set-face-attribute 'default (selected-frame) :height 65) ; reduces the font size of the new frame
  (cfw:open-calendar-buffer
   :contents-sources
   (list
    (cfw:org-create-source "Purple")  ; orgmode source
    (cfw:ical-create-source "TISS" "https://tiss.tuwien.ac.at/events/rest/calendar/personal?locale=de&amp;token=4463bf7a-87a3-490a-b54c-99b4a65192f3" "Cyan"))))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-h:48f5be2b-b3d2-4276-bd49-2630733f23d5" class="outline-3">
<h3 id="h:48f5be2b-b3d2-4276-bd49-2630733f23d5"><span class="section-number-3">5.35.</span> Dashboard: emacs startup screen</h3>
<div class="outline-text-3" id="text-h:48f5be2b-b3d2-4276-bd49-2630733f23d5">
<p>
This sets up the <code>dashboard</code>, which is really quite useless. But, it looks cool and makes me happy whenever I start an emacsclient without a file name as argument :)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package dashboard
  :ensure t
  :config
  (dashboard-setup-startup-hook)
  ;; (setq initial-buffer-choice (lambda () (get-buffer-create "*dashboard*")))
  (setq dashboard-display-icons-p t ;; display icons on both GUI and terminal
        dashboard-icon-type 'nerd-icons ;; use `nerd-icons' package
        dashboard-set-file-icons t
        dashboard-items '((recents . 5)
                          (projects . 5)
                          (agenda . 5))
        dashboard-set-footer nil
        dashboard-banner-logo-title "Welcome to SwarsEmacs!"
        dashboard-image-banner-max-height 300
        dashboard-startup-banner "~/.dotfiles/wallpaper/swarsel.png"
        dashboard-projects-backend 'projectile
        dashboard-projects-switch-function 'magit-status
        dashboard-set-navigator t
        dashboard-startupify-list '(dashboard-insert-banner
                                    dashboard-insert-newline
                                    dashboard-insert-banner-title
                                    dashboard-insert-newline
                                    dashboard-insert-navigator
                                    dashboard-insert-newline
                                    dashboard-insert-init-info
                                    dashboard-insert-items
                                    )
        dashboard-navigator-buttons
        `(;; line1
          ((,""
            "SwarselSocial"
            "Browse Swarsele"
            (lambda (&amp;rest _) (browse-url "instagram.com/Swarsele")))

           (,""
            "SwarselSound"
            "Browse SwarselSound"
            (lambda (&amp;rest _) (browse-url "sound.swarsel.win")) )
           (,""
            "SwarselSwarsel"
            "Browse Swarsel"
            (lambda (&amp;rest _) (browse-url "github.com/Swarsel")) )
           (,""
            "SwarselStash"
            "Browse SwarselStash"
            (lambda (&amp;rest _) (browse-url "stash.swarsel.win")) )
           (,"󰫑"
            "SwarselSport"
            "Browse SwarselSports"
            (lambda (&amp;rest _) (browse-url "social.parkour.wien/@Lenno")))
           )
          (
           (,"󱄅"
            "swarsel.win"
            "Browse swarsel.win"
            (lambda (&amp;rest _) (browse-url "swarsel.win")))
           )
          )))


</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Leon Schwarzäugl</p>
<p class="date">Created: 2024-06-20 Do 01:55</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
